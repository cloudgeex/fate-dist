{"version":3,"sources":["../../node_modules/tslib/tslib.es6.js","ng://fate-editor/app/fate-type.enum.ts","ng://fate-editor/app/fate-link-dropdown/fate-link-dropdown.component.ts","ng://fate-editor/app/fate-controller.service.ts","ng://fate-editor/app/fate-node.ts","ng://fate-editor/app/fate-html-parser.service.ts","ng://fate-editor/app/fate-parser.service.ts","ng://fate-editor/app/fate-icon.service.ts","ng://fate-editor/app/fate-ui/fate-ui.component.ts","ng://fate-editor/app/fate-input/fate-input.component.ts","ng://fate-editor/app/fate-bootstrap/fate-bootstrap.component.ts","ng://fate-editor/app/fate-material-icon.service.ts","ng://fate-editor/app/fate-material/fate-material.component.ts","ng://fate-editor/app/fate-fontawsome-legacy-icon.service.ts","ng://fate-editor/app/fate.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","FateType","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__values","o","s","Symbol","iterator","m","call","next","value","done","TypeError","__read","n","e","ar","push","error","__spread","concat","FateLinkDropdownComponent","valueChange","EventEmitter","changeValue","emit","selectNext","selecPrevious","confirmSelection","Input","Output","Component","selector","template","FateControllerService","actionMapping","bold","command","name","detect","BOLD","italic","ITALIC","underline","UNDERLINE","strike","STRIKETHROUGH","subscript","label","SUBSCRIPT","superscript","SUPERSCRIPT","heading1","HEADER1","heading2","HEADER2","heading3","HEADER3","heading4","HEADER4","heading5","HEADER5","heading6","HEADER6","normal","indent","outdent","ordered","ORDERED_LIST","unordered","UNORDERED_LIST","center","ALIGN_CENTER","justify","JUSTIFY","left","ALIGN_LEFT","right","ALIGN_RIGHT","undo","redo","clean","link","LINK","dropdown","inlineActionMapping","commandsPipe","default","Subject","enabledActions","registerAction","action","Error","getAction","actionName","registerInlineAction","getInlineAction","context","_b","keys","_c","match","regexp","exec","matched","channel","channelId","enabled","enableActions","nodes","actions","nodes_1","nodes_1_1","node","type","detected","do","doInline","Injectable","providedIn","NONE","children","FateHtmlParserService","parse","html","div","document","createElement","innerHTML","parseElement","element","parseType","currentNode","isABlock","PARAGRAPH","previousNodeWasText","childNodes","child","isLinebreak","Text","paragraph","FateNode","data","HTMLElement","findParentNodes","until","current","nodeType","parentElement","apply","getAdditonalStyle","style","detectedStyleNode","getAttribute","textAlign","color","COLOR","size","fontSize","SIZE","typeface","fontFamily","TYPEFACE","additionaStyle","nodeName","LISTITEM","marginLeft","INDENT","parseValue","serializeType","serialize","QUOTE","CODE","fallbackToBr","_this","serialized","forEach","FateParserService","_super","FateIconService","iconMapping","getIcon","defaultButtons","FateUiComponent","el","controller","icon","parser","factoryResolver","uiId","buttons","dropdownAction","mouseDown","event","closest","preventDefault","keyUp","name_1","stopPropagation","button_1","classList","contains","dropdown_1","nativeElement","querySelector","dropdownValue","console","debug","initDropdown","setTimeout","buttonSize","getBoundingClientRect","dropdownSize","leftPosition","offsetLeft","width","window","pageXOffset","innerWidth","topPosition","offsetTop","height","top","getOffset","offsetParent","actionComponent","dropdownComponent","destroy","component","resolveComponentFactory","viewContainerRef","parentInjector","instance","subscribe","newValue","insert","hostView","ngOnChanges","changes","inputSubscription","unsubscribe","actions_1","actions_1_1","ngAfterViewInit","addEventListener","ElementRef","ComponentFactoryResolver","HostListener","ViewChild","read","ViewContainerRef","static","FateInputComponent","htmlParser","sanitizer","placeholder","focus","blur","empty","isFocused","changed","reactToChanges","tree","editTarget","serializedTree","f","ngOnInit","subscribeToUi","row","computeHeight","saveSelection","checkForDropdownContext","restoreSelection","inlineAction","stopDefault","stopDefaultAndForceUpdate","checkEmpty","selectionRange","commonAncestorContainer","isContentEditable","selectNode","deleteContents","collapsed","startOffset","previousSibling","remove","endContainer","endOffset","nextSibling","dropdownInstance","getComputedStyle","minHeight","getHeight","ngOnDestroy","uiSubscription","rowCount","parseInt","lineHeight","boxSizing","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","activeElement","insertNode","createRange","createContextualFragment","collapse","execCommand","selectionInEditableTarget","sel","getSelection","getRangeAt","rangeCount","detectStyle","removeAllRanges","addRange","startContainer","nodeValue","writeValue","content","bypassSecurityTrustHtml","undefined","registerOnChange","fn","registerOnTouched","startPos","Math","max","textContent","substr","updateDropdown","position","end","setStart","updateDropdownPosition","display","parentOffsetBB","range","cloneRange","boundingBox","dropdownPostionTop","dropdownPostionLeft","DomSanitizer","FateInputComponent_1","providers","provide","NG_VALUE_ACCESSOR","useExisting","multi","instanceCounter","FateBootstrapComponent","clickOngoing","uiVisible","mousedown","mouseup","info","passthrough","onChange","FateBootstrapComponent_1","FateMaterialIconService","FateMaterialComponent","ngControl","id","_required","_disabled","errorState","controlType","describedBy","stateChanges","focused","valueAccessor","_placeholder","req","coerceBooleanProperty","dis","setDescribedByIds","ids","join","onContainerClick","complete","NgControl","Optional","Self","HostBinding","FateMaterialComponent_1","MatFormFieldControl","useClass","FateFontawsomeLegacyIconService","FateModule","NgModule","declarations","imports","CommonModule","FormsModule","MatFormFieldModule","FontAwesomeModule","exports","FateMaterialModule"],"mappings":";;;;;;;;;;;;;;oFAgBA,IAAIA,EAAgB,SAASC,EAAGC,GAI5B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,MACpDN,EAAGC,IAGrB,SAASO,EAAUR,EAAGC,GAEzB,SAASQ,IAAOC,KAAKC,YAAcX,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEY,UAAkB,OAANX,EAAaC,OAAOW,OAAOZ,IAAMQ,EAAGG,UAAYX,EAAEW,UAAW,IAAIH,GAG5E,IC7BKK,EDoDL,SAASC,EAAWC,EAAYC,EAAQC,EAAKC,GAChD,IAA2HnB,EAAvHoB,EAAIC,UAAUC,OAAQC,EAAIH,EAAI,EAAIH,EAAkB,OAATE,EAAgBA,EAAOjB,OAAOsB,yBAAyBP,EAAQC,GAAOC,EACrH,GAAuB,iBAAZM,SAAoD,mBAArBA,QAAQC,SAAyBH,EAAIE,QAAQC,SAASV,EAAYC,EAAQC,EAAKC,QACpH,IAAK,IAAIQ,EAAIX,EAAWM,OAAS,EAAGK,GAAK,EAAGA,KAAS3B,EAAIgB,EAAWW,MAAIJ,GAAKH,EAAI,EAAIpB,EAAEuB,GAAKH,EAAI,EAAIpB,EAAEiB,EAAQC,EAAKK,GAAKvB,EAAEiB,EAAQC,KAASK,GAChJ,OAAOH,EAAI,GAAKG,GAAKrB,OAAO0B,eAAeX,EAAQC,EAAKK,GAAIA,EAGzD,SAASM,EAAQC,EAAYC,GAChC,OAAO,SAAUd,EAAQC,GAAOa,EAAUd,EAAQC,EAAKY,IAsDpD,SAASE,EAASC,GACrB,IAAIC,EAAsB,mBAAXC,QAAyBA,OAAOC,SAAUC,EAAIH,GAAKD,EAAEC,GAAIP,EAAI,EAC5E,GAAIU,EAAG,OAAOA,EAAEC,KAAKL,GACrB,GAAIA,GAAyB,iBAAbA,EAAEX,OAAqB,MAAO,CAC1CiB,KAAM,WAEF,OADIN,GAAKN,GAAKM,EAAEX,SAAQW,OAAI,GACrB,CAAEO,MAAOP,GAAKA,EAAEN,KAAMc,MAAOR,KAG5C,MAAM,IAAIS,UAAUR,EAAI,0BAA4B,mCAGjD,SAASS,EAAOV,EAAGW,GACtB,IAAIP,EAAsB,mBAAXF,QAAyBF,EAAEE,OAAOC,UACjD,IAAKC,EAAG,OAAOJ,EACf,IAAmBV,EAAYsB,EAA3BlB,EAAIU,EAAEC,KAAKL,GAAOa,EAAK,GAC3B,IACI,WAAc,IAANF,GAAgBA,KAAM,MAAQrB,EAAII,EAAEY,QAAQE,MAAMK,EAAGC,KAAKxB,EAAEiB,OAExE,MAAOQ,GAASH,EAAI,CAAEG,MAAOA,GACjC,QACQ,IACQzB,IAAMA,EAAEkB,OAASJ,EAAIV,EAAU,SAAIU,EAAEC,KAAKX,GAE1D,QAAkB,GAAIkB,EAAG,MAAMA,EAAEG,OAE7B,OAAOF,EAGJ,SAASG,IACZ,IAAK,IAAIH,EAAK,GAAInB,EAAI,EAAGA,EAAIN,UAAUC,OAAQK,IAC3CmB,EAAKA,EAAGI,OAAOP,EAAOtB,UAAUM,KACpC,OAAOmB,GClJChC,EAAAA,EAAAA,WAAAA,EAAAA,SAAQ,KAClB,KAAA,OACAA,EAAA,UAAA,YACAA,EAAA,QAAA,UACAA,EAAA,QAAA,UACAA,EAAA,QAAA,UACAA,EAAA,QAAA,UACAA,EAAA,QAAA,UACAA,EAAA,QAAA,UACAA,EAAA,MAAA,QACAA,EAAA,KAAA,OACAA,EAAA,KAAA,OACAA,EAAA,KAAA,OACAA,EAAA,UAAA,YACAA,EAAA,UAAA,YACAA,EAAA,YAAA,cACAA,EAAA,cAAA,gBACAA,EAAA,OAAA,SACAA,EAAA,MAAA,QACAA,EAAA,UAAA,YACAA,EAAA,KAAA,OACAA,EAAA,WAAA,aACAA,EAAA,aAAA,eACAA,EAAA,YAAA,cACAA,EAAA,QAAA,UACAA,EAAA,aAAA,eACAA,EAAA,eAAA,iBACAA,EAAA,SAAA,WACAA,EAAA,OAAA,SACAA,EAAA,SAAA,4BCpBF,SAAAqC,IAMSzC,KAAA0C,YAAc,IAAIC,EAAAA,aAU3B,OARSF,EAAAvC,UAAA0C,YAAP,SAAoBd,GAClB9B,KAAK8B,MAAQA,EACb9B,KAAK0C,YAAYG,KAAKf,IAGjBW,EAAAvC,UAAA4C,WAAP,aACOL,EAAAvC,UAAA6C,cAAP,aACON,EAAAvC,UAAA8C,iBAAP,aAZA3C,EAAA,CADC4C,EAAAA,qCAID5C,EAAA,CADC6C,EAAAA,4CALUT,EAAyBpC,EAAA,CALrC8C,EAAAA,UAAU,CACTC,SAAU,qBACVC,SAAA,qHAGWZ,mBC2LX,SAAAa,IAjLUtD,KAAAuD,cAAgB,CACxBC,KAAS,CACPC,QAAS,OACTC,KAAM,OACNC,OAAQvD,EAAAA,SAASwD,MAEnBC,OAAW,CACTJ,QAAS,SACTC,KAAM,SACNC,OAAQvD,EAAAA,SAAS0D,QAEnBC,UAAc,CACZN,QAAS,YACTC,KAAM,aACNC,OAAQvD,EAAAA,SAAS4D,WAEnBC,OAAW,CACTR,QAAS,gBACTC,KAAM,iBACNC,OAAQvD,EAAAA,SAAS8D,eAEnBC,UAAc,CACZV,QAAS,YACTC,KAAM,YACNU,MAAO,MACPT,OAAQvD,EAAAA,SAASiE,WAEnBC,YAAgB,CACdb,QAAS,cACTC,KAAM,cACNU,MAAO,MACPT,OAAQvD,EAAAA,SAASmE,aAEnBC,SAAa,CACXf,QAAS,cACT3B,MAAO,KACP4B,KAAM,aACNU,MAAO,KACPT,OAAQvD,EAAAA,SAASqE,SAEnBC,SAAa,CACXjB,QAAS,cACT3B,MAAO,KACP4B,KAAM,aACNU,MAAO,KACPT,OAAQvD,EAAAA,SAASuE,SAEnBC,SAAa,CACXnB,QAAS,cACT3B,MAAO,KACP4B,KAAM,aACNU,MAAO,KACPT,OAAQvD,EAAAA,SAASyE,SAEnBC,SAAa,CACXrB,QAAS,cACT3B,MAAO,KACP4B,KAAM,aACNU,MAAO,KACPT,OAAQvD,EAAAA,SAAS2E,SAEnBC,SAAa,CACXvB,QAAS,cACT3B,MAAO,KACP4B,KAAM,aACNU,MAAO,KACPT,OAAQvD,EAAAA,SAAS6E,SAEnBC,SAAa,CACXzB,QAAS,cACT3B,MAAO,KACP4B,KAAM,aACNU,MAAO,KACPT,OAAQvD,EAAAA,SAAS+E,SAEnBC,OAAW,CACT3B,QAAS,cACT3B,MAAO,MACP4B,KAAM,SACNU,MAAO,KAETiB,OAAW,CACT5B,QAAS,SACTC,KAAM,UAER4B,QAAY,CACV7B,QAAS,UACTC,KAAM,WAER6B,QAAY,CACV9B,QAAS,oBACTC,KAAM,eACNC,OAAQvD,EAAAA,SAASoF,cAEnBC,UAAc,CACZhC,QAAS,sBACTC,KAAM,eACNC,OAAQvD,EAAAA,SAASsF,gBAEnBC,OAAW,CACTlC,QAAS,gBACTC,KAAM,SACNC,OAAQvD,EAAAA,SAASwF,cAEnBC,QAAY,CACVpC,QAAS,cACTC,KAAM,UACNC,OAAQvD,EAAAA,SAAS0F,SAEnBC,KAAS,CACPtC,QAAS,cACTC,KAAM,OACNC,OAAQvD,EAAAA,SAAS4F,YAEnBC,MAAU,CACRxC,QAAS,eACTC,KAAM,QACNC,OAAQvD,EAAAA,SAAS8F,aAEnBC,KAAS,CACP1C,QAAS,OACTC,KAAM,QAER0C,KAAS,CACP3C,QAAS,OACTC,KAAM,QAER2C,MAAU,CACR5C,QAAS,eACTC,KAAM,oBAER4C,KAAS,CACP7C,QAAS,aACT0C,KAAM,SACNzC,KAAM,OACNC,OAAQvD,EAAAA,SAASmG,KACjBC,SAAU/D,IAcJzC,KAAAyG,oBAA2B,GAmB3BzG,KAAA0G,aAAe,CACvBC,QAAS,IAAIC,EAAAA,SAGL5G,KAAA6G,eAAiB,CACzBF,QAAS,IAAIC,EAAAA,gBAnCRtD,EAAApD,UAAA4G,eAAP,SAAsBpD,EAAcqD,GAClC,GAAI/G,KAAKuD,cAAcG,GACrB,MAAM,IAAIsD,MAAM,4BAA8BtD,EAAO,qBAErD1D,KAAKuD,cAAcG,GAAQqD,GAGxBzD,EAAApD,UAAA+G,UAAP,SAAiBC,GACf,OAAOlH,KAAKuD,cAAc2D,KAAe,GAIpC5D,EAAApD,UAAAiH,qBAAP,SAA4BzD,EAAcqD,GACxC,GAAI/G,KAAKyG,oBAAoB/C,GAC3B,MAAM,IAAIsD,MAAM,mCAAqCtD,EAAO,qBAE5D1D,KAAKyG,oBAAoB/C,GAAQqD,GAG7BzD,EAAApD,UAAAkH,gBAAP,SAAuBC,eACtB,IAAqB,IAAAC,EAAAhG,EAAA9B,OAAO+H,KAAKvH,KAAKyG,sBAAoBe,EAAAF,EAAAzF,QAAA2F,EAAAzF,KAAAyF,EAAAF,EAAAzF,OAAE,CAAvD,IAAMkF,EAAMS,EAAA1F,MACT2F,EAAQzH,KAAKyG,oBAAoBM,GAAQW,OAAOC,KAAKN,GAC3D,GAAII,EAEF,OADAzH,KAAKyG,oBAAoBM,GAAQa,QAAUH,EAAM,GAC1CzH,KAAKyG,oBAAoBM,qGAGpC,OAAO,GAaFzD,EAAApD,UAAA2H,QAAP,SAAeC,GAIb,OAHK9H,KAAK0G,aAAaoB,KACrB9H,KAAK0G,aAAaoB,GAAa,IAAIlB,EAAAA,SAE9B5G,KAAK0G,aAAaoB,IAGpBxE,EAAApD,UAAA6H,QAAP,SAAeD,GAIb,OAHK9H,KAAK6G,eAAeiB,KACvB9H,KAAK6G,eAAeiB,GAAa,IAAIlB,EAAAA,SAEhC5G,KAAK6G,eAAeiB,IAGtBxE,EAAApD,UAAA8H,cAAP,SAAqBF,EAAWG,WACxBC,EAAsB,OAC5B,IAAmB,IAAAC,EAAA7G,EAAA2G,GAAKG,EAAAD,EAAAtG,QAAAuG,EAAArG,KAAAqG,EAAAD,EAAAtG,OAAE,CAArB,IAAMwG,EAAID,EAAAtG,MACb,IAAK,IAAMiF,KAAU/G,KAAKuD,cACxB,GAAIvD,KAAKuD,cAAcwD,GAAQpD,QAAU3D,KAAKuD,cAAcwD,GAAQpD,SAAW0E,EAAKC,KAClFJ,EAAQ7F,KAAK,CAAC0E,OAAQA,EAAQjF,MAAOuG,EAAKvG,aACrC,GAAI9B,KAAKuD,cAAcwD,GAAQpD,QAAuD,mBAAtC3D,KAAKuD,cAAcwD,GAAQpD,OAAuB,CACvG,IAAM4E,EAAWvI,KAAKuD,cAAcwD,GAAQpD,OAAO0E,GAC/CE,GACFL,EAAQ7F,KAAK,CAAC0E,OAAQA,EAAQjF,MAAOyG,EAASzG,2GAKtD9B,KAAK6G,eAAeiB,GAAWjG,KAAKqG,IAI/B5E,EAAApD,UAAAsI,GAAP,SAAUX,EAASd,EAAQjF,GACzB,GAAI9B,KAAKuD,cAAcwD,GAAQP,WAAa1E,EAAO,CACjD,IAAI9B,KAAKuD,cAAcwD,GAAQZ,KAG7B,MAAM,IAAIa,MAAM,WAAaD,EAAS,iCAFtC/G,KAAK0G,aAAamB,GAAShG,KAAK,CAAC6B,KAAM1D,KAAKuD,cAAcwD,GAAQZ,KAAMrE,MAAO9B,KAAKuD,cAAcwD,GAAQjF,OAASA,SAKjH9B,KAAKuD,cAAcwD,GAAQjF,OAAsD,mBAArC9B,KAAKuD,cAAcwD,GAAQjF,MACzE9B,KAAK0G,aAAamB,GAAShG,KAAK,CAAC6B,KAAM1D,KAAKuD,cAAcwD,GAAQtD,QAAS3B,MAAO9B,KAAKuD,cAAcwD,GAAQjF,MAAMA,KAEnH9B,KAAK0G,aAAamB,GAAShG,KAAK,CAAC6B,KAAM1D,KAAKuD,cAAcwD,GAAQtD,QAAS3B,MAAO9B,KAAKuD,cAAcwD,GAAQjF,OAASA,KAKrHwB,EAAApD,UAAAuI,SAAP,SAAgBZ,EAASd,EAAQjF,GAC/B,GAAIiF,EAAOP,WAAa1E,EAAO,CAC7B,IAAIiF,EAAOZ,KAGT,MAAM,IAAIa,MAAM,WAAaD,EAAS,iCAFtC/G,KAAK0G,aAAamB,GAAShG,KAAK,CAAC6B,KAAMqD,EAAOZ,KAAMrE,MAAOiF,EAAOjF,OAASA,SAKzEiF,EAAOjF,OAAkC,mBAAjBiF,EAAOjF,MACjC9B,KAAK0G,aAAamB,GAAShG,KAAK,CAAC6B,KAAMqD,EAAOtD,QAAS3B,MAAOiF,EAAOjF,MAAMA,KAE3E9B,KAAK0G,aAAamB,GAAShG,KAAK,CAAC6B,KAAMqD,EAAOtD,QAAS3B,MAAOiF,EAAOjF,OAASA,KAK7EwB,EAAApD,UAAAiG,KAAP,SAAY0B,EAASd,EAAQjF,GACX9B,KAAKuD,cAAcwD,GAAQZ,iGAxPlC7C,EAAqBjD,EAAA,CAHjCqI,EAAAA,WAAW,CACVC,WAAY,UAEDrF,QCZX,SAAmBgF,EAAuCxG,QAAvC,IAAAwG,IAAAA,EAAiBlI,EAAAA,SAASwI,MAA1B5I,KAAAsI,KAAAA,EAAuCtI,KAAA8B,MAAAA,EAEnD9B,KAAA6I,SAAqC,iBCK5C,SAAAC,YAEOA,EAAA5I,UAAA6I,MAAP,SAAaC,GACX,IAAMC,EAAMC,SAASC,cAAc,OAEnC,OADAF,EAAIG,UAAYJ,EACThJ,KAAKqJ,aAAaJ,IAGpBH,EAAA5I,UAAAmJ,aAAP,SAAoBC,GAKlB,IAJA,IAAMrB,EAAQjI,KAAKuJ,UAAUD,GACzBE,EAAcvB,EAAM,GAEpBwB,EAAYD,EAAYlB,OAASlI,EAAAA,SAASsJ,UACrCzI,EAAI,EAAGA,EAAIgH,EAAMrH,OAAQK,IAChCuI,EAAYX,SAASxG,KAAK4F,EAAMhH,KAChCuI,EAAcvB,EAAMhH,IACJqH,OAASlI,EAAAA,SAASsJ,YAChCD,GAAW,GAIf,IAAIE,GAAsB,EAC1B,IAAS1I,EAAI,EAAGA,EAAIqI,EAAQM,WAAWhJ,OAAQK,IAAM,CACnD,IAAM4I,EAAQP,EAAQM,WAAW3I,GAEjC,GACKA,EAAIqI,EAAQM,WAAWhJ,OAAS,GAChCZ,KAAK8J,YAAYR,EAAQM,WAAW3I,EAAI,OACvCwI,GAAYxI,IAAMqI,EAAQM,WAAWhJ,OAAS,GAIlD,GADA+I,GAAsB,EAClBE,aAAiBE,KAAM,CAEzB,IAAMC,EAAY,IAAIC,EAAS7J,EAAAA,SAASsJ,WACxCM,EAAUnB,SAASxG,KAAKwH,EAAMK,MAC9BV,EAAYX,SAASxG,KAAK2H,QACjBH,aAAiBM,cAE1BX,EAAYX,SAASxG,KAAKrC,KAAKqJ,aAAaQ,IAC5CL,EAAYX,SAASxG,KAAK,IAAI4H,EAAS7J,EAAAA,SAASsJ,kBAK9CG,aAAiBE,MAEfJ,EACFH,EAAYX,SAASW,EAAYX,SAASjI,OAAS,GAAK4I,EAAYX,SAASW,EAAYX,SAASjI,OAAS,GAAKiJ,EAAMK,KAEtHV,EAAYX,SAASxG,KAAKwH,EAAMK,MAElCP,GAAsB,GACbE,aAAiBM,cAC1BX,EAAYX,SAASxG,KAAKrC,KAAKqJ,aAAaQ,IAC5CF,GAAsB,GAM5B,OAAO1B,EAAM,IAGRa,EAAA5I,UAAAkK,gBAAP,SAAuB/B,EAAYgC,GAGjC,IAFA,IAAMpC,EAAyB,GAC3BqC,EAA0C,IAAlBjC,EAAKkC,SAAmBlC,EAAuBA,EAAKmC,cACzEF,IAAYD,GACjBpC,EAAM5F,KAAIoI,MAAVxC,EAAK1F,EAASvC,KAAKuJ,UAAUe,KAC7BA,EAAUA,EAAQE,cAEpB,OAAOvC,GAGCa,EAAA5I,UAAAwK,kBAAV,SAA4BpB,GAC1B,IAAMqB,EAAQrB,EAAQqB,MAChBC,EAAoB,GAG1B,OADctB,EAAQuB,aAAa,UAAYF,EAAMG,WAEnD,IAAK,OACHF,EAAkBvI,KAAK,IAAI4H,EAAS7J,EAAAA,SAAS4F,aAC7C,MACF,IAAK,SACH4E,EAAkBvI,KAAK,IAAI4H,EAAS7J,EAAAA,SAASwF,eAC7C,MACF,IAAK,QACHgF,EAAkBvI,KAAK,IAAI4H,EAAS7J,EAAAA,SAAS8F,cAC7C,MACF,IAAK,UACH0E,EAAkBvI,KAAK,IAAI4H,EAAS7J,EAAAA,SAAS0F,UAIjD,IAAMiF,EAAQzB,EAAQuB,aAAa,UAAYF,EAAMI,MAClDA,GACDH,EAAkBvI,KAAK,IAAI4H,EAAS7J,EAAAA,SAAS4K,MAAOD,IAGtD,IAAME,EAAO3B,EAAQuB,aAAa,SAAWF,EAAMO,SAC/CD,GACFL,EAAkBvI,KAAK,IAAI4H,EAAS7J,EAAAA,SAAS+K,KAAMF,IAGrD,IAAMG,EAAW9B,EAAQuB,aAAa,SAAWF,EAAMU,WAKvD,OAJID,GACFR,EAAkBvI,KAAK,IAAI4H,EAAS7J,EAAAA,SAASkL,SAAUF,IAGlDR,GAGC9B,EAAA5I,UAAAqJ,UAAV,SAAoBD,GAClB,IAAMiC,EAAiBvL,KAAK0K,kBAAkBpB,GAC9C,OAAQA,EAAQkC,UACd,IAAK,KACH,OAAAjJ,EAAA,CAAQ,IAAI0H,EAAS7J,EAAAA,SAASqE,UAAa8G,GAC7C,IAAK,KACH,OAAAhJ,EAAA,CAAQ,IAAI0H,EAAS7J,EAAAA,SAASuE,UAAa4G,GAC7C,IAAK,KACH,OAAAhJ,EAAA,CAAQ,IAAI0H,EAAS7J,EAAAA,SAASyE,UAAa0G,GAC7C,IAAK,KACH,OAAAhJ,EAAA,CAAQ,IAAI0H,EAAS7J,EAAAA,SAAS2E,UAAawG,GAC7C,IAAK,KACH,OAAAhJ,EAAA,CAAQ,IAAI0H,EAAS7J,EAAAA,SAAS6E,UAAasG,GAC7C,IAAK,KACH,OAAAhJ,EAAA,CAAQ,IAAI0H,EAAS7J,EAAAA,SAAS+E,UAAaoG,GAC7C,IAAK,IACL,IAAK,SACH,MAAO,CAAC,IAAItB,EAAS7J,EAAAA,SAASwD,OAChC,IAAK,IACL,IAAK,KACH,MAAO,CAAC,IAAIqG,EAAS7J,EAAAA,SAAS0D,SAChC,IAAK,IACH,MAAO,CAAC,IAAImG,EAAS7J,EAAAA,SAAS4D,YAChC,IAAK,SACH,MAAO,CAAC,IAAIiG,EAAS7J,EAAAA,SAAS8D,gBAChC,IAAK,MACH,MAAO,CAAC,IAAI+F,EAAS7J,EAAAA,SAASiE,YAChC,IAAK,MACH,MAAO,CAAC,IAAI4F,EAAS7J,EAAAA,SAASmE,cAChC,IAAK,IACH,MAAO,CAAC,IAAI0F,EAAS7J,EAAAA,SAASmG,KAAM+C,EAAQuB,aAAa,UAC3D,IAAK,KACH,MAAO,CAAC,IAAIZ,EAAS7J,EAAAA,SAASoF,eAChC,IAAK,KACH,MAAO,CAAC,IAAIyE,EAAS7J,EAAAA,SAASsF,iBAChC,IAAK,KACH,MAAO,CAAC,IAAIuE,EAAS7J,EAAAA,SAASqL,WAChC,IAAK,MACL,IAAK,IACH,OAAIF,EAAe3K,OAAS,EAC1B2B,EAAWgJ,GAEN,CAAC,IAAItB,EAAS7J,EAAAA,SAASsJ,YAChC,IAAK,aAEH,MAAiC,SAA7BJ,EAAQqB,MAAMe,WACT,CAAC,IAAIzB,EAAS7J,EAAAA,SAASuL,SAEzB,CAAC,IAAI1B,EAAS7J,EAAAA,SAASwI,OAChC,QACE,OAAI2C,EAAe3K,OAAS,EAC1B2B,EAAWgJ,GAEN,CAAC,IAAItB,EAAS7J,EAAAA,SAASwI,SAI1BE,EAAA5I,UAAA0L,WAAV,SAAqBtC,GACnB,OAAQA,EAAQkC,UACd,IAAK,IACH,OAAOlC,EAAQuB,aAAa,UAKxB/B,EAAA5I,UAAA2L,cAAV,SAAwBxD,GACtB,OAAQA,EAAKC,MACX,KAAKlI,EAAAA,SAASsJ,UACZ,MAAO,QAAU1J,KAAK8L,UAAUzD,GAAM,GAAQ,SAChD,KAAKjI,EAAAA,SAASqE,QACZ,MAAO,OAASzE,KAAK8L,UAAUzD,GAAM,GAAQ,QAC/C,KAAKjI,EAAAA,SAASuE,QACZ,MAAO,OAAS3E,KAAK8L,UAAUzD,GAAM,GAAQ,QAC/C,KAAKjI,EAAAA,SAASyE,QACZ,MAAO,OAAS7E,KAAK8L,UAAUzD,GAAM,GAAQ,QAC/C,KAAKjI,EAAAA,SAAS2E,QACZ,MAAO,OAAS/E,KAAK8L,UAAUzD,GAAM,GAAQ,QAC/C,KAAKjI,EAAAA,SAAS6E,QACZ,MAAO,OAASjF,KAAK8L,UAAUzD,GAAM,GAAQ,QAC/C,KAAKjI,EAAAA,SAAS+E,QACZ,MAAO,OAASnF,KAAK8L,UAAUzD,GAAM,GAAQ,QAC/C,KAAKjI,EAAAA,SAAS2L,MACZ,MAAO,UAAY/L,KAAK8L,UAAUzD,GAAQ,WAC5C,KAAKjI,EAAAA,SAAS4L,KACZ,MAAO,SAAWhM,KAAK8L,UAAUzD,GAAQ,UAC3C,KAAKjI,EAAAA,SAASwD,KACZ,MAAO,WAAa5D,KAAK8L,UAAUzD,GAAQ,YAC7C,KAAKjI,EAAAA,SAAS0D,OACZ,MAAO,OAAS9D,KAAK8L,UAAUzD,GAAQ,QACzC,KAAKjI,EAAAA,SAAS4D,UACZ,MAAO,MAAQhE,KAAK8L,UAAUzD,GAAQ,OACxC,KAAKjI,EAAAA,SAAS8D,cACZ,MAAO,WAAalE,KAAK8L,UAAUzD,GAAQ,YAC7C,KAAKjI,EAAAA,SAASiE,UACZ,MAAO,QAAUrE,KAAK8L,UAAUzD,GAAQ,SAC1C,KAAKjI,EAAAA,SAASmE,YACZ,MAAO,QAAUvE,KAAK8L,UAAUzD,GAAQ,SAC1C,KAAKjI,EAAAA,SAASmG,KACZ,MAAO,YAAc8B,EAAKvG,MAAQ,KAAO9B,KAAK8L,UAAUzD,GAAQ,OAClE,KAAKjI,EAAAA,SAASoF,aACZ,MAAO,OAASxF,KAAK8L,UAAUzD,GAAQ,QACzC,KAAKjI,EAAAA,SAASsF,eACZ,MAAO,OAAS1F,KAAK8L,UAAUzD,GAAQ,QACzC,KAAKjI,EAAAA,SAASqL,SACZ,MAAO,OAASzL,KAAK8L,UAAUzD,GAAQ,QACzC,KAAKjI,EAAAA,SAAS4F,WACZ,MAAO,kCAAoChG,KAAK8L,UAAUzD,GAAM,GAAQ,SAC1E,KAAKjI,EAAAA,SAASwF,aACZ,MAAO,oCAAsC5F,KAAK8L,UAAUzD,GAAM,GAAQ,SAC5E,KAAKjI,EAAAA,SAAS8F,YACZ,MAAO,kCAAoClG,KAAK8L,UAAUzD,GAAM,GAAQ,SAC1E,KAAKjI,EAAAA,SAAS0F,QACZ,MAAO,qCAAuC9F,KAAK8L,UAAUzD,GAAM,GAAQ,SAC7E,KAAKjI,EAAAA,SAASuL,OACZ,MAAO,yCAA2C3L,KAAK8L,UAAUzD,GAAM,GAAQ,gBACjF,KAAKjI,EAAAA,SAAS4K,MACZ,MAAO,gBAAkB3C,EAAKvG,MAAQ,KAAO9B,KAAK8L,UAAUzD,GAAQ,UACtE,KAAKjI,EAAAA,SAAS+K,KACZ,MAAO,eAAiB9C,EAAKvG,MAAQ,KAAO9B,KAAK8L,UAAUzD,GAAQ,UACrE,KAAKjI,EAAAA,SAASkL,SACZ,MAAO,eAAiBjD,EAAKvG,MAAQ,KAAO9B,KAAK8L,UAAUzD,GAAQ,UACrE,KAAKjI,EAAAA,SAASwI,KACZ,OAAO5I,KAAK8L,UAAUzD,KAIlBS,EAAA5I,UAAA4J,YAAV,SAAsBD,GACpB,OAAQA,aAAiBM,aAAkC,OAAnBN,EAAM2B,UAIzC1C,EAAA5I,UAAA4L,UAAP,SAAkBzD,EAAgB4D,GAAlC,IAAAC,EAAAlM,UAAkC,IAAAiM,IAAAA,GAAA,GAChC,IAAIE,EAAa,GAWjB,OAVA9D,EAAKQ,SAASuD,SAAQ,SAACvC,GAEnBsC,GADmB,iBAAVtC,EACKA,EAEAqC,EAAKL,cAAchC,MAGjCoC,IAAiBE,IACnBA,EAAa,QAERA,8FAjQErD,EAAqBzI,EAAA,CAHjCqI,EAAAA,WAAW,CACVC,WAAY,UAEDG,oBCAb,SAAAuD,0DAAuCvM,EAAAuM,EAAAC,8FAA1BD,EAAiBhM,EAAA,CAH7BqI,EAAAA,WAAW,CACVC,WAAY,UAED0D,IAA0BvD,gBCDvC,SAAAyD,IAEYvM,KAAAwM,YAAmB,CAC3BhJ,KAAM,OACNK,OAAQ,SACRE,UAAW,YACXE,OAAQ,gBACRE,UAAW,YACXG,YAAa,cACbe,OAAQ,SACRC,QAAS,UACTC,QAAS,UACTE,UAAW,UACXE,OAAQ,eACRE,QAAS,gBACTE,KAAM,aACNE,MAAO,cACPE,KAAM,WACNC,KAAM,WACNC,MAAO,SACPC,KAAM,eAGDiG,EAAArM,UAAAuM,QAAP,SAAevF,GACb,OAAOlH,KAAKwM,YAAYtF,+FAxBfqF,EAAelM,EAAA,CAH3BqI,EAAAA,WAAW,CACVC,WAAY,UAED4D,MCCAG,EAAiB,CAC5B,OACA,SACA,YACA,SACA,YACA,YACA,cACA,OACA,YACA,WACA,WACA,WACA,WACA,WACA,WACA,SACA,YACA,SACA,UACA,UACA,YACA,YACA,SACA,UACA,OACA,QACA,YACA,OACA,OACA,sBAuBA,SAAAC,EAAsBC,EAAuBC,EAA0CC,EAAiCC,EAAqCC,GAAvIhN,KAAA4M,GAAAA,EAAuB5M,KAAA6M,WAAAA,EAA0C7M,KAAA8M,KAAAA,EAAiC9M,KAAA+M,OAAAA,EAAqC/M,KAAAgN,gBAAAA,EAZtJhN,KAAAiN,KAAe,UAGfjN,KAAAkN,QAAyBR,EAEzB1M,KAAA+H,QAAe,GACf/H,KAAAmN,gBAAmC,EAmI5C,OA1HSR,EAAAzM,UAAAkN,UAAP,SAAiBC,GACVA,EAAM9M,OAAO+M,QAAQ,sBACxBD,EAAME,kBAKHZ,EAAAzM,UAAAsN,MAAP,SAAaH,GACX,GAAkB,UAAdA,EAAM7M,IAAiB,CACzB,IAAMiN,EAAOJ,EAAM9M,OAAOmD,KACtB+J,GACFzN,KAAKwI,GAAG6E,EAAOI,KAWdd,EAAAzM,UAAAsI,GAAP,SAAU6E,EAAOtG,GAAjB,IAAAmF,EAAAlM,KAGE,GAFAqN,EAAME,iBACNF,EAAMK,kBACF1N,KAAK6M,WAAW5F,UAAUF,GAAQP,SACpC,GAAIO,IAAW/G,KAAKmN,eAClBnN,KAAKmN,gBAAiB,MACjB,CACL,IAAIQ,EAASN,EAAM9M,OAInB,GAHKoN,EAAOC,UAAUC,SAAS,oBAC7BF,EAASA,EAAOL,QAAQ,qBAEtBK,EACF,OAEF,IAAMG,EAAY9N,KAAK4M,GAAGmB,cAAcC,cAAc,qBAItDhO,KAAKiO,cAAgBjO,KAAK+H,QAAQhB,GAClCmH,QAAQC,MAAM,mBAAoBR,EAAQG,EAAU9N,KAAKiO,eACzDjO,KAAKoO,aAAapO,KAAK6M,WAAW5F,UAAUF,GAAQP,SAAUxG,KAAKiO,eAGnEI,YAAW,WACT,IAAMC,EAAaX,EAAOY,wBACpBC,EAAgBV,EAASS,wBAC3BE,EAAed,EAAOe,WAAcJ,EAAWK,MAAQ,EAAMH,EAAaG,MAAQ,EAElFL,EAAWvI,KAAO6I,OAAOC,YAAeP,EAAWK,MAAQ,EAAMH,EAAaG,MAAQ,EAAK,EAC7FF,GAAiBH,EAAWvI,KAAO6I,OAAOC,YAAclB,EAAOe,WAAa,EACnEJ,EAAWvI,KAAO6I,OAAOC,YAAeP,EAAWK,MAAQ,EAAMH,EAAaG,MAAQ,EAAKC,OAAOE,WAAa,IACxHL,EAAeG,OAAOE,WAAaR,EAAWvI,KAAO6I,OAAOC,YAAclB,EAAOe,WAAaF,EAAaG,MAAQ,GAErH,IAAMI,EAAcpB,EAAOqB,UAAYV,EAAWW,OAAS,EAC3DnB,EAASnD,MAAM5E,KAAO0I,EAAe,KACrCX,EAASnD,MAAMuE,IAAMH,EAAc,KAEnC7C,EAAKiB,eAAiBpG,IACrB,QAGL/G,KAAKmN,gBAAiB,EACtBnN,KAAK6M,WAAWrE,GAAGxI,KAAKiN,KAAMlG,IAIxB4F,EAAAzM,UAAAiP,UAAV,SAAoB7F,GAClB,IAAI4F,EAAM,EACNnJ,EAAO,EACX,GACImJ,GAAO5F,EAAQ0F,WAAc,EAC7BjJ,GAAQuD,EAAQoF,YAAc,EAC9BpF,EAAUA,EAAQ8F,mBACb9F,GAET,MAAO,CACH4F,IAAKA,EACLnJ,KAAMA,IAIF4G,EAAAzM,UAAAkO,aAAV,SAAuBiB,EAAiBvN,GAAxC,IAAAoK,EAAAlM,KACMA,KAAKsP,mBACPtP,KAAKsP,kBAAkBC,UAEzB,IACMC,EADUxP,KAAKgN,gBAAgByC,wBAAwBJ,GAC9BlP,OAAOH,KAAK0P,iBAAiBC,gBAC5D,IAAIH,EAAUI,SAASlN,YAQrB,MAAM,IAAIsE,MAAM,2EAPhBwI,EAAUI,SAAS9N,MAAQA,EAC3B0N,EAAUI,SAASlN,YAAYmN,WAAU,SAACC,GACxC5D,EAAK+B,cAAgB6B,EACrB5D,EAAKW,WAAWrE,GAAG0D,EAAKe,KAAMf,EAAKiB,eAAgB2C,MAErD9P,KAAKsP,kBAAoBtP,KAAK0P,iBAAiBK,OAAOP,EAAUQ,WAM7DrD,EAAAzM,UAAA+P,YAAP,SAAmBC,GAAnB,IAAAhE,EAAAlM,KACMkQ,EAAc,OACZlQ,KAAKmQ,mBACPnQ,KAAKmQ,kBAAkBC,cAEzBpQ,KAAKmQ,kBAAoBnQ,KAAK6M,WAAW9E,QAAQ/H,KAAKiN,MAAM4C,WAAU,SAAC3H,WACrEgE,EAAKnE,QAAU,OACf,IAAqB,IAAAsI,EAAA/O,EAAA4G,GAAOoI,EAAAD,EAAAxO,QAAAyO,EAAAvO,KAAAuO,EAAAD,EAAAxO,OAAE,CAAzB,IAAMkF,EAAMuJ,EAAAxO,MACfoK,EAAKnE,QAAQhB,EAAOA,QAAUA,EAAOjF,QAAS,0GAM/C6K,EAAAzM,UAAAqQ,gBAAP,WAAA,IAAArE,EAAAlM,KACiB4O,OAAO4B,iBAAiB,aAAa,SAACnD,GAC7CA,EAAM9M,OAAmB+M,QAAQ,uBACrCpB,EAAKiB,gBAAiB,gDAzHFsD,EAAAA,kBAA+BnN,SAAoCiJ,SAAmCF,SAA8CqE,EAAAA,4BAZ9KrQ,EAAA,CADC4C,EAAAA,oCAID5C,EAAA,CADC4C,EAAAA,uCAaD5C,EAAA,CADCsQ,EAAAA,aAAa,YAAa,CAAC,0CAQ5BtQ,EAAA,CADCsQ,EAAAA,aAAa,QAAS,CAAC,sCAcxBtQ,EAAA,CAJCuQ,EAAAA,UAAU,WAAY,CACrBC,KAAMC,EAAAA,iBACNC,QAAQ,4CApCCpE,EAAetM,EAAA,CAL3B8C,EAAAA,UAAU,CACTC,SAAU,UACVC,SAAA,m9DAGWsJ,mBCsDX,SAAAqE,EAAsBpE,EAA0BC,EAA6CoE,EAA6ClE,EAAqCmE,EAAmClE,GAA5LhN,KAAA4M,GAAAA,EAA0B5M,KAAA6M,WAAAA,EAA6C7M,KAAAiR,WAAAA,EAA6CjR,KAAA+M,OAAAA,EAAqC/M,KAAAkR,UAAAA,EAAmClR,KAAAgN,gBAAAA,EAjC3MhN,KAAAiN,KAAe,UASfjN,KAAAmR,YAAsB,GAGtBnR,KAAAoR,MAAQ,IAAIzO,EAAAA,aAGZ3C,KAAAqR,KAAO,IAAI1O,EAAAA,aAcX3C,KAAAsR,OAAiB,EAEdtR,KAAAuR,WAAqB,EAuRrBvR,KAAAwR,QAAU,IAAI7R,YAkF1B,SA3YaqR,EAsCHA,EAAA9Q,UAAAuR,eAAR,WACE,IAAMC,EAAO1R,KAAKiR,WAAW5H,aAAarJ,KAAK2R,YACzCC,EAAiB5R,KAAK+M,OAAOjB,UAAU4F,GAC7C1R,KAAKwR,QAAQpF,SAAQ,SAAAyF,GAAK,OAAAA,EAAED,OAGvBZ,EAAA9Q,UAAA4R,SAAP,WACE9R,KAAK+R,cAAc/R,KAAKiN,OAGnB+D,EAAA9Q,UAAAqQ,gBAAP,WAAA,IAAArE,EAAAlM,KACEA,KAAK2R,WAAa3R,KAAK4M,GAAGmB,cAAcC,cAAc,qBAClDhO,KAAKgS,KACPhS,KAAKiS,gBAGPjS,KAAK2R,WAAWnB,iBAAiB,SAAS,SAACnD,GACzCa,QAAQC,MAAM,SAEdjC,EAAKgG,gBAELhG,EAAKiG,6BAGPnS,KAAK2R,WAAWnB,iBAAiB,SAAS,SAACnD,GACzCa,QAAQC,MAAM,cAEdjC,EAAKgG,gBAELhG,EAAKiG,6BAGPnS,KAAK2R,WAAWnB,iBAAiB,SAAS,SAACnD,GACzCa,QAAQC,MAAM,IAAMjC,EAAKe,KAAO,WAEhCf,EAAKkG,mBACLlG,EAAKqF,WAAY,EACjBrF,EAAKkF,MAAMvO,UAEb7C,KAAK2R,WAAWnB,iBAAiB,QAAQ,SAACnD,GACxCa,QAAQC,MAAM,IAAMjC,EAAKe,KAAO,UAChCf,EAAKqF,WAAY,EACjBrF,EAAKmF,KAAKxO,OACVqJ,EAAKgG,gBAEDhG,EAAKoD,mBACPjB,YAAW,WACTnC,EAAKmG,aAAe,KACpBnG,EAAKoD,kBAAkBC,YACtB,QAMPvP,KAAK2R,WAAWnB,iBAAiB,WAAW,SAACnD,GAC3Ca,QAAQC,MAAM,UAAWd,GACzB,IAAMiF,EAAc,WAClBjF,EAAME,iBACNF,EAAMK,mBAEF6E,EAA4B,WAChCD,IACApG,EAAKsG,aACLtG,EAAKuF,kBAcP,GAAkB,cAAdpE,EAAM7M,KAAqC,WAAd6M,EAAM7M,KAAoB0L,EAAKuG,eAAgB,CAC9E,IAAMpK,EAAO6D,EAAKuG,eAAeC,wBACjCxE,QAAQC,MAAM,WAAY9F,GACtBA,aAAgB8B,cAAiB9B,EAAqBsK,mBAExDzE,QAAQC,MAAM,8CACdjC,EAAKuG,eAAeG,WAAWvK,GAC/B6D,EAAKuG,eAAeI,iBACpBN,KAC2B,UAAlBlK,EAAKmD,UAAyBnD,EAAKmC,cAAcmI,oBAE1DzE,QAAQC,MAAM,8CACdjC,EAAKuG,eAAeG,WAAWvK,EAAKmC,eACpC0B,EAAKuG,eAAeI,iBACpBN,KAMJ,GAAkB,cAAdlF,EAAM7M,KAAuB0L,EAAKuG,eAAgB,CAC9CpK,EAAO6D,EAAKuG,eAAeC,yBACK,IAAlCxG,EAAKuG,eAAeK,WACgB,IAApC5G,EAAKuG,eAAeM,aACpB1K,EAAK2K,2BAA2B7I,cAC9B9B,EAAK2K,gBAAgCL,oBACzCtK,EAAK2K,gBAAgBC,SACrBV,UAEG,GAAkB,WAAdlF,EAAM7M,KAAoB0L,EAAKuG,eAAgB,CAClDpK,EAAO6D,EAAKuG,eAAeC,yBACK,IAAlCxG,EAAKuG,eAAeK,WAC0B,UAA9C5G,EAAKuG,eAAeS,aAAa1H,UACjCU,EAAKuG,eAAeU,YAAejH,EAAKuG,eAAeS,aAAsBtS,QAC7EyH,EAAK+K,uBAAuBjJ,cAC1B9B,EAAK+K,YAA4BT,oBACrCtK,EAAK+K,YAAYH,SACjBV,KAMArG,EAAKmG,eACW,OAAdhF,EAAM7M,KAA8B,YAAd6M,EAAM7M,KAC9B8R,IACApG,EAAKmH,iBAAiBtQ,iBACC,SAAdsK,EAAM7M,KAAgC,cAAd6M,EAAM7M,KACvC8R,IACApG,EAAKmH,iBAAiBvQ,cACC,UAAduK,EAAM7M,MACf8R,IACApG,EAAKmH,iBAAiBrQ,wBAK5BhD,KAAK2R,WAAWnB,iBAAiB,SAAS,SAACnD,GACzCa,QAAQC,MAAM,iBACdjC,EAAKsG,aACLtG,EAAKuF,oBAEY7C,OAAO0E,iBAAiBtT,KAAK2R,YAChD3R,KAAK2R,WAAWhH,MAAM4I,UAAYvT,KAAKwT,UAAU,IAG5CxC,EAAA9Q,UAAA+P,YAAP,SAAmBC,GACbA,EAAc,MAChBlQ,KAAK+R,cAAc/R,KAAKiN,MAEtBiD,EAAa,KACXlQ,KAAK2R,YACP3R,KAAKiS,iBAKJjB,EAAA9Q,UAAAuT,YAAP,WACMzT,KAAK0T,gBACP1T,KAAK0T,eAAetD,eAIdY,EAAA9Q,UAAA+R,cAAV,WACEjS,KAAK2R,WAAWhH,MAAMsE,OAASjP,KAAKwT,UAAUxT,KAAKgS,MAG3ChB,EAAA9Q,UAAAsS,WAAV,WACoC,KAA9BxS,KAAK2R,WAAWvI,WAClBpJ,KAAK2R,WAAWvI,UAAY,OAC5BpJ,KAAKsR,OAAQ,GAC0B,SAA9BtR,KAAK2R,WAAWvI,UACzBpJ,KAAKsR,OAAQ,EAEbtR,KAAKsR,OAAQ,GAIPN,EAAA9Q,UAAAsT,UAAV,SAAoBG,GAClB,IAAMhJ,EAAaiE,OAAO0E,iBAAiBtT,KAAK2R,YAC5C1C,EAASjP,KAAK2R,WAAWhH,MAAMsE,OAAU2E,SAASjJ,EAAMkJ,WAAY,IAAMF,EAI9E,MAHwB,eAApBhJ,EAAMmJ,YACR7E,GAAU2E,SAASjJ,EAAMoJ,WAAY,IAAMH,SAASjJ,EAAMqJ,cAAe,IAAMJ,SAASjJ,EAAMsJ,eAAgB,IAAML,SAASjJ,EAAMuJ,kBAAmB,KAEjJjF,EAAS,MAIR+B,EAAA9Q,UAAA6R,cAAV,SAAwB9E,GAAxB,IAAAf,EAAAlM,KACEkO,QAAQC,MAAM,kBAAoBlB,EAAMjN,KAAK0T,gBACzC1T,KAAK0T,gBACP1T,KAAK0T,eAAetD,cAEtBpQ,KAAK0T,eAAiB1T,KAAK6M,WAAWhF,QAAQoF,GAAM4C,WAAU,SAACpM,GAE7D,IAAM2N,EAAQlI,SAASiL,cACvBjG,QAAQC,MAAM,IAAMlB,EAAO,iBAAmBxJ,EAAQC,KAAO,IAAMD,EAAQ3B,OAE3EoK,EAAKkG,mBACgB,eAAjB3O,EAAQC,MAAyBwI,EAAKuG,gBAGxCvG,EAAKuG,eAAeI,iBAEpB3G,EAAKuG,eAAe2B,WAAWlL,SAASmL,cAAcC,yBAAyB7Q,EAAQ3B,QAEvFoK,EAAKuG,eAAe8B,UAAS,GAE7BrI,EAAKsG,aACLtG,EAAKuF,kBAELvI,SAASsL,YAAY/Q,EAAQC,MAAM,EAAOD,EAAQ3B,OAEpDoK,EAAKgG,gBACJd,EAAcA,YAMTJ,EAAA9Q,UAAAgS,cAAV,WACE,GAAIlS,KAAKyU,4BAA6B,CACpC,IAAMC,EAAM9F,OAAO+F,eACfD,EAAIE,YAAcF,EAAIG,aACxB7U,KAAKyS,eAAiBiC,EAAIE,WAAW,GACrC1G,QAAQC,MAAM,IAAMnO,KAAKiN,KAAO,kBAAmBjN,KAAKyS,gBACxDzS,KAAK8U,iBAKD9D,EAAA9Q,UAAAkS,iBAAV,WACE,IAAIpS,KAAKyU,8BAGTvG,QAAQC,MAAM,IAAMnO,KAAKiN,KAAO,qBAAsBjN,KAAKyS,gBACvDzS,KAAKyS,gBAAgB,CACvB,IAAMiC,EAAM9F,OAAO+F,eACnBD,EAAIK,kBACJL,EAAIM,SAAShV,KAAKyS,kBAIZzB,EAAA9Q,UAAAuU,0BAAV,WACE,IAAMC,EAAM9F,OAAO+F,eACbtM,EAAOqM,EAAIE,YAAcF,EAAIG,YAAcH,EAAIE,WAAW,IAAMF,EAAIE,WAAW,GAAGlC,wBACxF,OAAOrK,IAASA,IAASrI,KAAK2R,YAAetJ,EAAKmC,cAAc8C,QAAQ,sBAAyBjF,EAAKmC,cAAc8C,QAAQ,uBAAyBtN,KAAK2R,aAGlJX,EAAA9Q,UAAA4U,YAAV,WACE,IAAIzM,EAAOrI,KAAKyS,eAAeC,wBAC/B,GAAKrK,GAAWA,EAAKmC,cAAc8C,QAAQ,sBAAwBjF,IAASrI,KAAK2R,aAM1C,IAAlC3R,KAAKyS,eAAeU,WACpBnT,KAAKyS,eAAewC,eAAwB,WAC5CjV,KAAKyS,eAAeM,cAAgB/S,KAAKyS,eAAewC,eAAeC,UAAUtU,OACpFyH,EAAOrI,KAAKyS,eAAewC,eAAe7B,YACE,IAAlCpT,KAAKyS,eAAeU,WACS,IAApCnT,KAAKyS,eAAeM,YACvB1K,EAAOrI,KAAKyS,eAAewC,eAAezK,cAChCxK,KAAKyS,eAAeC,0BAA4B1S,KAAK2R,YACrD3R,KAAKyS,eAAewC,iBAAmBjV,KAAK2R,YAC5C3R,KAAKyS,eAAeS,eAAiBlT,KAAK2R,aACpDtJ,EAAOrI,KAAKyS,eAAeC,wBAAwB9I,WAAW5J,KAAKyS,eAAeM,cAEhF1K,GAAQA,IAASrI,KAAK2R,YAAY,CACpC,IAAM1J,EAAQjI,KAAKiR,WAAW7G,gBAAgB/B,EAAMrI,KAAK2R,YACzDzD,QAAQC,MAAM,0BAA2BlG,GACzCjI,KAAK6M,WAAW7E,cAAchI,KAAKiN,KAAMhF,KAOtC+I,EAAA9Q,UAAAiV,WAAP,SAAkBrT,GACZA,GACF9B,KAAKoV,QAAUpV,KAAKkR,UAAUmE,wBAAwBrV,KAAKiR,WAAWnF,UAAU9L,KAAK+M,OAAOhE,MAAMjH,KAClG9B,KAAKsR,OAAQ,IAEbtR,KAAKoV,QAAUpV,KAAKkR,UAAUmE,wBAAwB,QACtDrV,KAAKsR,OAAQ,GAEftR,KAAKyS,oBAAiB6C,GAGjBtE,EAAA9Q,UAAAqV,iBAAP,SAAwBC,GACtBxV,KAAKwR,QAAQnP,KAAKmT,IAGbxE,EAAA9Q,UAAAuV,kBAAP,SAAyBD,KAEfxE,EAAA9Q,UAAAiS,wBAAV,WACE,IAAMuD,EAAWC,KAAKC,IAAI5V,KAAKyS,eAAeM,YAAc,GAAI,GAC1DnS,EAASZ,KAAKyS,eAAeM,YAAc2C,EAC3CrO,EAAUrH,KAAKyS,eAAewC,eAAeY,YAAYC,OAAOJ,EAAU9U,GAE1EyR,EAAerS,KAAK6M,WAAWzF,gBAAgBC,GACjDgL,EACGrS,KAAKqS,cAAgBrS,KAAKqS,aAAa7L,WAAa6L,EAAa7L,UAIpExG,KAAKqS,aAAeA,EACpBrS,KAAK+V,eAAe1D,EAAazK,WAJjC5H,KAAKqS,aAAeA,EACpBrS,KAAKoO,aAAaiE,EAAcrS,KAAKyS,eAAelE,0BAK7CvO,KAAKsP,oBACdtP,KAAKqS,aAAe,KACpBrS,KAAKsP,kBAAkBC,YAIjByB,EAAA9Q,UAAAkO,aAAV,SAAuBiB,EAAiB2G,GAAxC,IAAA9J,EAAAlM,KAEMA,KAAKsP,mBACPtP,KAAKsP,kBAAkBC,UAEzB,IACMC,EADUxP,KAAKgN,gBAAgByC,wBAAwBJ,EAAgB7I,UAC9CrG,OAAOH,KAAK0P,iBAAiBC,gBAC5D,IAAIH,EAAUI,SAASlN,YAerB,MAAM,IAAIsE,MAAM,2EAdhBwI,EAAUI,SAAS9N,MAAQuN,EAAgBzH,QAC3C4H,EAAUI,SAASlN,YAAYmN,WAAU,SAAC/N,GACxCoK,EAAKyF,WAAWP,QAChB,IAAM6E,EAAM/J,EAAKuG,eAAeU,UAChCjH,EAAKuG,eAAeyD,SAAShK,EAAKuG,eAAeS,aAAc+C,EAAM5G,EAAgBzH,QAAQhH,QAC7FsL,EAAKW,WAAWpE,SAASyD,EAAKe,KAAMf,EAAKmG,aAAcvQ,GAEvDoK,EAAKmG,aAAe,KACpBnG,EAAKoD,kBAAkBC,aAEzBvP,KAAKsP,kBAAoBtP,KAAK0P,iBAAiBK,OAAOP,EAAUQ,UAChEhQ,KAAKqT,iBAAmB7D,EAAUI,SAClC5P,KAAKmW,0BAMCnF,EAAA9Q,UAAA6V,eAAV,SAAyBjU,GACvB9B,KAAKqT,iBAAiBvR,MAAQA,EAC9B9B,KAAKmW,0BAGGnF,EAAA9Q,UAAAiW,uBAAV,WACE,GAAkC,eAA9BnW,KAAKqS,aAAa+D,QAA0B,CAE9C,IAAMC,EAAiBrW,KAAK4M,GAAGmB,cAAcqB,aAAab,wBACpD+H,EAAQtW,KAAKyS,eAAe8D,aAC5BN,EAAMK,EAAMnD,UAClBmD,EAAMJ,SAASI,EAAMpD,aAAc+C,EAAMjW,KAAKqS,aAAazK,QAAQhH,QACnE,IAAM4V,EAAcF,EAAM/H,wBAC1BvO,KAAKyW,mBAAsBD,EAAYtH,IAAMsH,EAAYvH,OAASoH,EAAenH,IAAO,KACxFlP,KAAK0W,oBAAuBF,EAAYzQ,KAAOsQ,EAAetQ,KAAQ,gDApWhD0K,EAAAA,kBAAkCnN,SAA6CwF,SAAyCuD,SAAwCsK,EAAAA,oBAAyCjG,EAAAA,4BAjCnOrQ,EAAA,CADC4C,EAAAA,oCAID5C,EAAA,CADC4C,EAAAA,mCAID5C,EAAA,CADC4C,EAAAA,2CAID5C,EAAA,CADC4C,EAAAA,2CAID5C,EAAA,CADC6C,EAAAA,sCAID7C,EAAA,CADC6C,EAAAA,qCAOD7C,EAAA,CAJCuQ,EAAAA,UAAU,WAAY,CACrBC,KAAMC,EAAAA,iBACNC,QAAQ,4CAtBCC,EAAkB4F,EAAAvW,EAAA,CAtD9B8C,EAAAA,UAAU,CACTC,SAAU,aACVC,SAAU,sfAgDVwT,UAAW,CACT,CAACC,QAASC,EAAAA,kBAAmBC,YAAaJ,EAAoBK,OAAO,YAnC9D,ozBAsCEjG,MCxDTkG,EAAkB,eAqDpB,SAAAC,EAAYvK,EAAgBC,EAAmCE,EAA2BD,EAAuBE,GAlC1GhN,KAAAkN,QAAyBR,EAGtB1M,KAAAwR,QAAU,IAAI7R,MACdK,KAAAoX,cAAwB,EA+BhCpX,KAAKiN,KAAO,aAAgBiK,UAkBhC,SA9DaC,EAqBJA,EAAAjX,UAAAmR,KAAP,SAAahE,GACNrN,KAAKoX,eACRpX,KAAKqX,WAAY,IAKdF,EAAAjX,UAAAoX,UAAP,SAAkBjK,GAChBrN,KAAKoX,cAAe,GAIfD,EAAAjX,UAAAqX,QAAP,SAAgBlK,GACdrN,KAAKoX,cAAe,GAIfD,EAAAjX,UAAAkR,MAAP,SAAc/D,GACZrN,KAAKqX,WAAY,EACjBnJ,QAAQsJ,KAAK,oBAORL,EAAAjX,UAAAiV,WAAP,SAAkBrT,GAChB9B,KAAKyX,YAAc3V,GAGdqV,EAAAjX,UAAAqV,iBAAP,SAAwBC,GACtBxV,KAAKwR,QAAQnP,KAAKmT,IAGb2B,EAAAjX,UAAAuV,kBAAP,SAAyBD,KAGlB2B,EAAAjX,UAAAwX,SAAP,SAAgB5V,GACd9B,KAAKyX,YAAc3V,EACnB9B,KAAKwR,QAAQpF,SAAQ,SAAAyF,GAAK,OAAAA,EAAE/P,gDAjBd2O,EAAAA,kBAAwBnN,SAA+B+I,SAAyBE,SAAkCmE,EAAAA,4BAxClIrQ,EAAA,CADC4C,EAAAA,mCAID5C,EAAA,CADC4C,EAAAA,2CAID5C,EAAA,CADC4C,EAAAA,uCAaD5C,EAAA,CADCsQ,EAAAA,aAAa,WAAY,CAAC,qCAQ3BtQ,EAAA,CADCsQ,EAAAA,aAAa,YAAa,CAAC,0CAM5BtQ,EAAA,CADCsQ,EAAAA,aAAa,UAAW,CAAC,wCAM1BtQ,EAAA,CADCsQ,EAAAA,aAAa,UAAW,CAAC,sCArCfwG,EAAsBQ,EAAAtX,EAAA,CARlC8C,EAAAA,UAAU,CACTC,SAAU,iBACVC,SAAA,oSAEAwT,UAAW,CACT,CAACC,QAASC,EAAAA,kBAAmBC,YAAaW,EAAwBV,OAAO,g/BAGhEE,oBCXb,SAAAS,0DAA6C9X,EAAA8X,EAAAtL,8FAAhCsL,EAAuBvX,EAAA,CAHnCqI,EAAAA,WAAW,CACVC,WAAY,UAEDiP,IAAgCrL,GCMzC2K,EAAkB,eAsHpB,SAAAW,EAAYhL,EAAmCE,EAA2BD,EAAuBF,EAA2CkL,GAAA9X,KAAA8X,UAAAA,EArGrI9X,KAAAkN,QAAyBR,EAyBhC1M,KAAA+X,GAAK,GAAG/X,KAAKiN,KA2BNjN,KAAAoX,cAAe,EACfpX,KAAAqX,WAAY,EAkBTrX,KAAAgY,WAAY,EAUZhY,KAAAiY,WAAY,EAEfjY,KAAAkY,YAAa,EAEblY,KAAAmY,YAAc,gBAGrBnY,KAAAoY,YAAc,GAQPpY,KAAAqY,aAAe,IAAIzR,EAAAA,QACnB5G,KAAAsY,SAAU,EAEPtY,KAAAwR,QAAU,IAAI7R,MAGtBK,KAAKiN,KAAO,YAAeiK,IAGL,MAAlBlX,KAAK8X,YACP9X,KAAK8X,UAAUS,cAAgBvY,YAwBrC,SAxIa6X,EASXrY,OAAA0B,eAAW2W,EAAA3X,UAAA,QAAK,KAAhB,WACE,OAAOF,KAAKyX,iBAEd,SAAiB3V,GACf9B,KAAKqY,aAAaxW,OAClB7B,KAAKyX,YAAc3V,EACnB9B,KAAKwR,QAAQpF,SAAQ,SAAAyF,GAAK,OAAAA,EAAE/P,uCAK9BtC,OAAA0B,eAAI2W,EAAA3X,UAAA,cAAW,KAAf,WACE,OAAOF,KAAKwY,kBAEd,SAAgBrH,GACdnR,KAAKwY,aAAerH,EACpBnR,KAAKqY,aAAaxW,wCASbgW,EAAA3X,UAAAmR,KAAP,WACErR,KAAKsY,SAAU,EACftY,KAAKqY,aAAaxW,OACb7B,KAAKoX,eACRpX,KAAKqX,WAAY,IAKdQ,EAAA3X,UAAAkR,MAAP,WACEpR,KAAKsY,SAAU,EACftY,KAAKqX,WAAY,EACjBrX,KAAKqY,aAAaxW,QAIbgW,EAAA3X,UAAAoX,UAAP,SAAkBjK,GAChBrN,KAAKoX,cAAe,GAIfS,EAAA3X,UAAAqX,QAAP,SAAgBlK,GACdrN,KAAKoX,cAAe,GAKtB5X,OAAA0B,eAAI2W,EAAA3X,UAAA,QAAK,KAAT,WACE,OAAQF,KAAKyX,aAAoC,KAArBzX,KAAKyX,6CAGnCjY,OAAA0B,eAAI2W,EAAA3X,UAAA,mBAAgB,KAApB,WACE,OAAOF,KAAKsY,UAAYtY,KAAKsR,uCAI/B9R,OAAA0B,eAAI2W,EAAA3X,UAAA,WAAQ,KAAZ,WACE,OAAOF,KAAKgY,eAEd,SAAaS,GACXzY,KAAKgY,UAAYU,EAAAA,sBAAsBD,GACvCzY,KAAKqY,aAAaxW,wCAKpBrC,OAAA0B,eAAI2W,EAAA3X,UAAA,WAAQ,KAAZ,WACE,OAAOF,KAAKiY,eAEd,SAAaU,GACX3Y,KAAKiY,UAAYS,EAAAA,sBAAsBC,GACvC3Y,KAAKqY,aAAaxW,wCAWbgW,EAAA3X,UAAA0Y,kBAAP,SAAyBC,GACvB7Y,KAAKoY,YAAcS,EAAIC,KAAK,MAGvBjB,EAAA3X,UAAA6Y,iBAAP,SAAwB1L,KAgBjBwK,EAAA3X,UAAAwX,SAAP,SAAgB5V,GACd9B,KAAKyX,YAAc3V,EACnB9B,KAAKwR,QAAQpF,SAAQ,SAAAyF,GAAK,OAAAA,EAAE/P,MAC5B9B,KAAKqY,aAAaxW,QAGbgW,EAAA3X,UAAAuT,YAAP,WACEzT,KAAKqY,aAAaW,YAGbnB,EAAA3X,UAAAiV,WAAP,SAAkBrT,GAChB9B,KAAKyX,YAAc3V,EACnB9B,KAAKqY,aAAaxW,QAGbgW,EAAA3X,UAAAqV,iBAAP,SAAwBC,GACtBxV,KAAKwR,QAAQnP,KAAKmT,IAGbqC,EAAA3X,UAAAuV,kBAAP,SAAyBD,8CA5BDlS,SAA+B+I,SAAyBE,SAAqBkE,EAAAA,kBAAkDwI,EAAAA,UAAS3Y,WAAA,CAAA,CAAAgI,KAA9C4Q,EAAAA,UAAQ,CAAA5Q,KAAI6Q,EAAAA,UAxG9H9Y,EAAA,CADC4C,EAAAA,mCAID5C,EAAA,CADC4C,EAAAA,uCAID5C,EAAA,CADC4C,EAAAA,mCAYD5C,EAAA,CADC4C,EAAAA,yCAYD5C,EAAA,CADC+Y,EAAAA,wCAID/Y,EAAA,CADCsQ,EAAAA,aAAa,sCAUdtQ,EAAA,CADCsQ,EAAAA,aAAa,sCAQdtQ,EAAA,CADCsQ,EAAAA,aAAa,YAAa,CAAC,0CAM5BtQ,EAAA,CADCsQ,EAAAA,aAAa,UAAW,CAAC,wCAgB1BtQ,EAAA,CADC4C,EAAAA,sCAWD5C,EAAA,CADC4C,EAAAA,sCAeD5C,EAAA,CADC+Y,EAAAA,YAAY,4DA7FFvB,EAAqBwB,EAAAhZ,EAAA,CATjC8C,EAAAA,UAAU,CACTC,SAAU,gBACVC,SAAA,uPAEAwT,UAAW,CACT,CAAEC,QAASwC,EAAAA,oBAAqBtC,YAAaqC,GAC7C,CAAEvC,QAASvK,EAAiBgN,SAAU3B,o8CA8G0EzW,EAAA,EAAA+X,EAAAA,YAAY/X,EAAA,EAAAgY,EAAAA,SA3GnHtB,oBCjBb,SAAA2B,IAAA,IAAAtN,EAAA,OAAAI,GAAAA,EAAA7B,MAAAzK,KAAAW,YAAAX,YAEYkM,EAAAM,YAAc,CACtBhJ,KAAS,6BACTK,OAAW,+BACXE,UAAc,kCACdE,OAAW,sCACXE,UAAe,kCACfG,YAAgB,oCAChBe,OAAW,+BACXC,QAAY,gCACZC,QAAY,gCACZE,UAAc,gCACdE,OAAW,qCACXE,QAAY,sCACZE,KAAS,mCACTE,MAAU,oCACVE,KAAS,6BACTC,KAAS,+BACTC,MAAU,+BACVC,KAAS,uCApBwCxG,EAAA0Z,EAAAlN,8FAAxCkN,EAA+BnZ,EAAA,CAH3CqI,EAAAA,WAAW,CACVC,WAAY,UAED6Q,IAAwCjN,gBCmCrD,SAAAkN,KAAyB,OAAZA,EAAUpZ,EAAA,CAftBqZ,EAAAA,SAAS,CACRC,aAAc,CACZ3I,EACArE,EACAwK,EACA1U,GAEFmX,QAAS,CAACC,EAAAA,aAAcC,EAAAA,YAAaC,EAAAA,mBAAoBC,EAAAA,mBACzDC,QAAS,CACPtN,EACAqE,EACAmG,EACA1U,MAGSgX,mBAOb,SAAAS,KAAiC,OAApBA,EAAkB7Z,EAAA,CAL9BqZ,EAAAA,SAAS,CACRC,aAAc,CAAC9B,GACf+B,QAAS,CAACC,EAAAA,aAAcC,EAAAA,YAAaC,EAAAA,mBAAoBN,GACzDQ,QAAS,CAACpC,MAECqC","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export enum FateType {\n  NONE = 'NONE',\n  PARAGRAPH = 'PARAGRAPH',\n  HEADER1 = 'HEADER1',\n  HEADER2 = 'HEADER2',\n  HEADER3 = 'HEADER3',\n  HEADER4 = 'HEADER4',\n  HEADER5 = 'HEADER5',\n  HEADER6 = 'HEADER6',\n  QUOTE = 'QUOTE',\n  CODE = 'CODE',\n  SIZE = 'SIZE',\n  BOLD = 'BOLD',\n  HIGHLIGHT = 'HIGHLIGHT',\n  SUBSCRIPT = 'SUBSCRIPT',\n  SUPERSCRIPT = 'SUPERSCRIPT',\n  STRIKETHROUGH = 'STRIKETHROUGH',\n  ITALIC = 'ITALIC',\n  COLOR = 'COLOR',\n  UNDERLINE = 'UNDERLINE',\n  LINK = 'LINK',\n  ALIGN_LEFT = 'ALIGN_LEFT',\n  ALIGN_CENTER = 'ALIGN_CENTER',\n  ALIGN_RIGHT = 'ALIGN_RIGHT',\n  JUSTIFY = 'JUSTIFY',\n  ORDERED_LIST = 'ORDERED_LIST',\n  UNORDERED_LIST = 'UNORDERED_LIST',\n  LISTITEM = 'LISTITEM',\n  INDENT = 'INDENT',\n  TYPEFACE = 'TYPEFACE',\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\nimport { FateDropdown } from '../fate-dropdown.interface';\n\n@Component({\n  selector: 'fate-link-dropdown',\n  templateUrl: './fate-link-dropdown.component.html',\n  styleUrls: ['./fate-link-dropdown.component.scss']\n})\nexport class FateLinkDropdownComponent implements FateDropdown {\n\n  @Input()\n  public value: string;\n\n  @Output()\n  public valueChange = new EventEmitter<string>();\n\n  public changeValue (value) {\n    this.value = value;\n    this.valueChange.emit(value);\n  }\n\n  public selectNext () {};\n  public selecPrevious () {};\n  public confirmSelection () {};\n}\n","import { Injectable } from '@angular/core';\n\nimport { Subject } from 'rxjs';\n\nimport { FateType } from './fate-type.enum';\nimport { FateLinkDropdownComponent } from './fate-link-dropdown/fate-link-dropdown.component';\n\nexport interface FateCommand {\n  name: string;\n  value: any;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FateControllerService {\n\n  // List of available commands, alphabetically\n  // see https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand\n  protected actionMapping = {\n    'bold' : {\n      command: 'bold',\n      name: 'Bold',\n      detect: FateType.BOLD\n    },\n    'italic' : {\n      command: 'italic',\n      name: 'Italic',\n      detect: FateType.ITALIC\n    },\n    'underline' : {\n      command: 'underline',\n      name: 'Underlined',\n      detect: FateType.UNDERLINE\n    },\n    'strike' : {\n      command: 'strikeThrough',\n      name: 'Strike Through',\n      detect: FateType.STRIKETHROUGH\n    },\n    'subscript' : {\n      command: 'subscript',\n      name: 'Subscript',\n      label: 'sub',\n      detect: FateType.SUBSCRIPT\n    },\n    'superscript' : {\n      command: 'superscript',\n      name: 'Superscript',\n      label: 'sup',\n      detect: FateType.SUPERSCRIPT\n    },\n    'heading1' : {\n      command: 'formatBlock',\n      value: 'H1',\n      name: '1st Header',\n      label: 'h1',\n      detect: FateType.HEADER1\n    },\n    'heading2' : {\n      command: 'formatBlock',\n      value: 'H2',\n      name: '2nd Header',\n      label: 'h2',\n      detect: FateType.HEADER2\n    },\n    'heading3' : {\n      command: 'formatBlock',\n      value: 'H3',\n      name: '3rd Header',\n      label: 'h3',\n      detect: FateType.HEADER3\n    },\n    'heading4' : {\n      command: 'formatBlock',\n      value: 'H4',\n      name: '4th Header',\n      label: 'h4',\n      detect: FateType.HEADER4\n    },\n    'heading5' : {\n      command: 'formatBlock',\n      value: 'H5',\n      name: '5th Header',\n      label: 'h5',\n      detect: FateType.HEADER5\n    },\n    'heading6' : {\n      command: 'formatBlock',\n      value: 'H6',\n      name: '6th Header',\n      label: 'h6',\n      detect: FateType.HEADER6\n    },\n    'normal' : {\n      command: 'formatBlock',\n      value: 'DIV',\n      name: 'Normal',\n      label: 'p',\n    },\n    'indent' : {\n      command: 'indent',\n      name: 'Indent',\n    },\n    'outdent' : {\n      command: 'outdent',\n      name: 'Outdent',\n    },\n    'ordered' : {\n      command: 'insertOrderedList',\n      name: 'Ordered List',\n      detect: FateType.ORDERED_LIST\n    },\n    'unordered' : {\n      command: 'insertUnorderedList',\n      name: 'Unorder List',\n      detect: FateType.UNORDERED_LIST\n    },\n    'center' : {\n      command: 'justifyCenter',\n      name: 'Center',\n      detect: FateType.ALIGN_CENTER\n    },\n    'justify' : {\n      command: 'justifyFull',\n      name: 'Justify',\n      detect: FateType.JUSTIFY\n    },\n    'left' : {\n      command: 'justifyLeft',\n      name: 'Left',\n      detect: FateType.ALIGN_LEFT\n    },\n    'right' : {\n      command: 'justifyRight',\n      name: 'Right',\n      detect: FateType.ALIGN_RIGHT\n    },\n    'undo' : {\n      command: 'undo',\n      name: 'Undo',\n    },\n    'redo' : {\n      command: 'redo',\n      name: 'Redo',\n    },\n    'clean' : {\n      command: 'removeFormat',\n      name: 'Remove Formating',\n    },\n    'link' : {\n      command: 'createLink',\n      undo: 'unlink',\n      name: 'Link',\n      detect: FateType.LINK,\n      dropdown: FateLinkDropdownComponent\n    }\n  };\n  public registerAction(name: string, action: any) {\n    if (this.actionMapping[name]) {\n      throw new Error('An action with the name \"' + name + '\" already exists!');\n    } else {\n      this.actionMapping[name] = action;\n    }\n  }\n  public getAction(actionName): boolean | any {\n    return this.actionMapping[actionName] || false;\n  }\n\n  protected inlineActionMapping: any = {};\n  public registerInlineAction(name: string, action: any) {\n    if (this.inlineActionMapping[name]) {\n      throw new Error('An inline action with the name \"' + name + '\" already exists!');\n    } else {\n      this.inlineActionMapping[name] = action;\n    }\n  }\n   public getInlineAction(context: string): boolean | any {\n    for (const action of Object.keys(this.inlineActionMapping)) {\n      const match = this.inlineActionMapping[action].regexp.exec(context);\n      if (match) {\n        this.inlineActionMapping[action].matched = match[1];\n        return this.inlineActionMapping[action];\n      }\n    }\n    return false;\n  }\n\n  protected commandsPipe = {\n    default: new Subject<FateCommand>()\n  };\n\n  protected enabledActions = {\n    default: new Subject<any>()\n  };\n\n  constructor() { }\n\n  public channel(channelId) {\n    if (!this.commandsPipe[channelId]) {\n      this.commandsPipe[channelId] = new Subject<FateCommand>();\n    }\n    return this.commandsPipe[channelId];\n  }\n\n  public enabled(channelId) {\n    if (!this.enabledActions[channelId]) {\n      this.enabledActions[channelId] = new Subject<any>();\n    }\n    return this.enabledActions[channelId];\n  }\n\n  public enableActions(channelId, nodes) {\n    const actions: Array<any> = [];\n    for (const node of nodes) {\n      for (const action in this.actionMapping) {\n        if (this.actionMapping[action].detect && this.actionMapping[action].detect === node.type) {\n          actions.push({action: action, value: node.value});\n        } else if (this.actionMapping[action].detect && typeof this.actionMapping[action].detect === 'function') {\n          const detected = this.actionMapping[action].detect(node);\n          if (detected) {\n            actions.push({action: action, value: detected.value});\n          }\n        }\n      }\n    }\n    this.enabledActions[channelId].next(actions);\n  }\n\n\n  public do(channel, action, value?) {\n    if (this.actionMapping[action].dropdown && !value) {\n      if (this.actionMapping[action].undo) {\n        this.commandsPipe[channel].next({name: this.actionMapping[action].undo, value: this.actionMapping[action].value || value});\n      } else {\n        throw new Error('Action \"' + action + '\"doesn\\'t have a undo command');\n      }\n    } else {\n      if (this.actionMapping[action].value && (typeof this.actionMapping[action].value === 'function')) {\n        this.commandsPipe[channel].next({name: this.actionMapping[action].command, value: this.actionMapping[action].value(value)});\n      } else {\n        this.commandsPipe[channel].next({name: this.actionMapping[action].command, value: this.actionMapping[action].value || value});\n      }\n    }\n  }\n\n  public doInline(channel, action, value?) {\n    if (action.dropdown && !value) {\n      if (action.undo) {\n        this.commandsPipe[channel].next({name: action.undo, value: action.value || value});\n      } else {\n        throw new Error('Action \"' + action + '\"doesn\\'t have a undo command');\n      }\n    } else {\n      if (action.value && (typeof action.value === 'function')) {\n        this.commandsPipe[channel].next({name: action.command, value: action.value(value)});\n      } else {\n        this.commandsPipe[channel].next({name: action.command, value: action.value || value});\n      }\n    }\n  }\n\n  public undo(channel, action, value?) {\n    const mapping = this.actionMapping[action].undo;\n    // TODO\n  }\n}\n","import { FateType } from './fate-type.enum';\n\nexport class FateNode {\n  constructor(public type: FateType = FateType.NONE, public value?: any) {}\n\n  public children: Array<FateNode | string> = [];\n}\n","import { Injectable } from '@angular/core';\n\nimport { FateNode } from './fate-node';\nimport { FateType } from './fate-type.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FateHtmlParserService {\n\n  constructor() { }\n\n  public parse(html: string): FateNode {\n    const div = document.createElement('div');\n    div.innerHTML = html;\n    return this.parseElement(div);\n  };\n\n  public parseElement(element: HTMLElement): FateNode {\n    const nodes = this.parseType(element);\n    let currentNode = nodes[0];\n    \n    let isABlock = (currentNode.type === FateType.PARAGRAPH);\n    for (let i = 1; i < nodes.length; i++) {\n      currentNode.children.push(nodes[i]);\n      currentNode = nodes[i];\n      if (currentNode.type === FateType.PARAGRAPH) {\n        isABlock = true;\n      }\n    }\n\n    let previousNodeWasText = false;\n    for (let i = 0; i < element.childNodes.length; i ++) {\n      const child = element.childNodes[i];\n      // pick ahead to look for <br>\n      if (\n          (i < element.childNodes.length - 1) &&\n          (this.isLinebreak(element.childNodes[i + 1])) &&\n          !(isABlock && i === element.childNodes.length - 2) // The last child is a BR in a block, this can be ignored\n        ) {\n\n        previousNodeWasText = false;\n        if (child instanceof Text) {\n          // wrap the text in a paragraph\n          const paragraph = new FateNode(FateType.PARAGRAPH);\n          paragraph.children.push(child.data);\n          currentNode.children.push(paragraph);\n        } else if (child instanceof HTMLElement) {\n          // insert an empty paragraph\n          currentNode.children.push(this.parseElement(child));\n          currentNode.children.push(new FateNode(FateType.PARAGRAPH));\n        } else {\n          // ignore\n        }\n      } else {\n        if (child instanceof Text) {\n          // If two \"pure\" text node follow one another we can safely merge then as one (for i > 0)\n          if (previousNodeWasText) {\n            currentNode.children[currentNode.children.length - 1] = currentNode.children[currentNode.children.length - 1] + child.data;\n          } else {\n            currentNode.children.push(child.data);\n          }\n          previousNodeWasText = true;\n        } else if (child instanceof HTMLElement) {\n          currentNode.children.push(this.parseElement(child));\n          previousNodeWasText = false;\n        } else {\n          // ignore\n        }\n      }\n    }\n    return nodes[0];\n  }\n\n  public findParentNodes(node: Node, until: Node): Array<FateNode> {\n    const nodes: Array<FateNode> = [];\n    let current: HTMLElement = (node.nodeType === 1) ? (node as HTMLElement) : node.parentElement;\n    while (current !== until) {\n      nodes.push(...this.parseType(current));\n      current = current.parentElement;\n    }\n    return nodes;\n  }\n\n  protected getAdditonalStyle(element: HTMLElement): Array<FateNode> {\n    const style = element.style;\n    const detectedStyleNode = [];\n    // Look for alignement\n    const align = element.getAttribute('align') || style.textAlign;\n    switch (align) {\n      case 'left':\n        detectedStyleNode.push(new FateNode(FateType.ALIGN_LEFT));\n        break;\n      case 'center':\n        detectedStyleNode.push(new FateNode(FateType.ALIGN_CENTER));\n        break;\n      case 'right':\n        detectedStyleNode.push(new FateNode(FateType.ALIGN_RIGHT));\n        break;\n      case 'justify':\n        detectedStyleNode.push(new FateNode(FateType.JUSTIFY));\n        break;\n    }\n    // Look for color\n    const color = element.getAttribute('color') || style.color;\n    if(color) {\n      detectedStyleNode.push(new FateNode(FateType.COLOR, color));\n    }\n    // Look for size\n    const size = element.getAttribute('size') || style.fontSize;\n    if (size) {\n      detectedStyleNode.push(new FateNode(FateType.SIZE, size));\n    }\n    // Look for family\n    const typeface = element.getAttribute('face') || style.fontFamily;\n    if (typeface) {\n      detectedStyleNode.push(new FateNode(FateType.TYPEFACE, typeface));\n    }\n\n    return detectedStyleNode;\n  }\n\n  protected parseType(element: HTMLElement): Array<FateNode> {\n    const additionaStyle = this.getAdditonalStyle(element);\n    switch (element.nodeName) {\n      case 'H1':\n        return [new FateNode(FateType.HEADER1), ...additionaStyle];\n      case 'H2':\n        return [new FateNode(FateType.HEADER2), ...additionaStyle];\n      case 'H3':\n        return [new FateNode(FateType.HEADER3), ...additionaStyle];\n      case 'H4':\n        return [new FateNode(FateType.HEADER4), ...additionaStyle];\n      case 'H5':\n        return [new FateNode(FateType.HEADER5), ...additionaStyle];\n      case 'H6':\n        return [new FateNode(FateType.HEADER6), ...additionaStyle];\n      case 'B':\n      case 'STRONG':\n        return [new FateNode(FateType.BOLD)];\n      case 'I':\n      case 'EM':\n        return [new FateNode(FateType.ITALIC)];\n      case 'U':\n        return [new FateNode(FateType.UNDERLINE)];\n      case 'STRIKE':\n        return [new FateNode(FateType.STRIKETHROUGH)];\n      case 'SUB':\n        return [new FateNode(FateType.SUBSCRIPT)];\n      case 'SUP':\n        return [new FateNode(FateType.SUPERSCRIPT)];\n      case 'A':\n        return [new FateNode(FateType.LINK, element.getAttribute('href'))];\n      case 'OL':\n        return [new FateNode(FateType.ORDERED_LIST)];\n      case 'UL':\n        return [new FateNode(FateType.UNORDERED_LIST)];\n      case 'LI':\n        return [new FateNode(FateType.LISTITEM)];\n      case 'DIV':\n      case 'P':\n        if (additionaStyle.length > 0) {\n          return [...additionaStyle];\n        }\n        return [new FateNode(FateType.PARAGRAPH)];\n      case 'BLOCKQUOTE':\n        // FIXME: this doesn't work on FF\n        if (element.style.marginLeft === '40px') {\n          return [new FateNode(FateType.INDENT)];\n        }\n        return [new FateNode(FateType.NONE)];\n      default:\n        if (additionaStyle.length > 0) {\n          return [...additionaStyle];\n        }\n        return [new FateNode(FateType.NONE)];\n    }\n  }\n\n  protected parseValue(element: HTMLElement): any {\n    switch (element.nodeName) {\n      case 'A':\n        return element.getAttribute('href');\n    }\n    return undefined;\n  }\n\n  protected serializeType(node: FateNode): string {\n    switch (node.type) {\n      case FateType.PARAGRAPH:\n        return '<div>' + this.serialize(node, true) + '</div>';\n      case FateType.HEADER1:\n        return '<h1>' + this.serialize(node, true) + '</h1>';\n      case FateType.HEADER2:\n        return '<h2>' + this.serialize(node, true) + '</h2>';\n      case FateType.HEADER3:\n        return '<h3>' + this.serialize(node, true) + '</h3>';\n      case FateType.HEADER4:\n        return '<h4>' + this.serialize(node, true) + '</h4>';\n      case FateType.HEADER5:\n        return '<h5>' + this.serialize(node, true) + '</h5>';\n      case FateType.HEADER6:\n        return '<h6>' + this.serialize(node, true) + '</h6>';\n      case FateType.QUOTE:\n        return '<quote>' + this.serialize(node) + '</quote>';\n      case FateType.CODE:\n        return '<code>' + this.serialize(node) + '</code>';\n      case FateType.BOLD:\n        return '<strong>' + this.serialize(node) + '</strong>';\n      case FateType.ITALIC:\n        return '<em>' + this.serialize(node) + '</em>';\n      case FateType.UNDERLINE:\n        return '<u>' + this.serialize(node) + '</u>';\n      case FateType.STRIKETHROUGH:\n        return '<strike>' + this.serialize(node) + '</strike>';\n      case FateType.SUBSCRIPT:\n        return '<sub>' + this.serialize(node) + '</sub>';\n      case FateType.SUPERSCRIPT:\n        return '<sup>' + this.serialize(node) + '</sup>';\n      case FateType.LINK:\n        return '<a href=\"' + node.value + '\">' + this.serialize(node) + '</a>';\n      case FateType.ORDERED_LIST:\n        return '<ol>' + this.serialize(node) + '</ol>';\n      case FateType.UNORDERED_LIST:\n        return '<ul>' + this.serialize(node) + '</ul>';\n      case FateType.LISTITEM:\n        return '<li>' + this.serialize(node) + '</li>';\n      case FateType.ALIGN_LEFT:\n        return '<div style=\"text-align: left;\">' + this.serialize(node, true) + '</div>';\n      case FateType.ALIGN_CENTER:\n        return '<div style=\"text-align: center;\">' + this.serialize(node, true) + '</div>';\n      case FateType.ALIGN_RIGHT:\n        return '<div style=\"text-align: right\">' + this.serialize(node, true) + '</div>';\n      case FateType.JUSTIFY:\n        return '<div style=\"text-align: justify;\">' + this.serialize(node, true) + '</div>';\n      case FateType.INDENT:\n        return '<blockquote style=\"margin-left: 40px\">' + this.serialize(node, true) + '</blockquote>';\n      case FateType.COLOR:\n        return '<font color=\"' + node.value + '\">' + this.serialize(node) + '</font>';\n      case FateType.SIZE:\n        return '<font size=\"' + node.value + '\">' + this.serialize(node) + '</font>';\n      case FateType.TYPEFACE:\n        return '<font face=\"' + node.value + '\">' + this.serialize(node) + '</font>';\n      case FateType.NONE:\n        return this.serialize(node);\n    }\n  };\n\n  protected isLinebreak(child: Node): boolean {\n    return (child instanceof HTMLElement && child.nodeName === 'BR');\n  }\n\n  // Saves a Tree in string representation\n  public serialize (node: FateNode, fallbackToBr: boolean = false): string {\n    let serialized = '';\n    node.children.forEach((child) => {\n      if (typeof child === 'string') {\n        serialized += child;\n      } else {\n        serialized += this.serializeType(child);\n      }\n    });\n    if (fallbackToBr && !serialized) {\n      serialized = '<br>';\n    }\n    return serialized;\n  };\n}\n","import { Injectable } from '@angular/core';\n\nimport { FateHtmlParserService } from './fate-html-parser.service';\nimport { FateParser } from './fate-parser.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FateParserService extends FateHtmlParserService implements FateParser {}\n","import { Injectable } from '@angular/core';\n\nimport { FateIcon } from './fate-icon.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FateIconService implements FateIcon {\n  // font awesome\n  protected iconMapping: any = {\n    bold: 'bold',\n    italic: 'italic',\n    underline: 'underline',\n    strike: 'strikethrough',\n    subscript: 'subscript',\n    superscript: 'superscript',\n    indent: 'indent',\n    outdent: 'outdent',\n    ordered: 'list-ol',\n    unordered: 'list-ul',\n    center: 'align-center',\n    justify: 'align-justify',\n    left: 'align-left',\n    right: 'align-right',\n    undo: 'undo-alt',\n    redo: 'redo-alt',\n    clean: 'eraser',\n    link: 'link'\n  };\n\n  public getIcon(actionName): string {\n    return this.iconMapping[actionName];\n  }\n}\n","import { Component, Input, ElementRef, HostListener, OnChanges, AfterViewInit, ComponentFactoryResolver, ViewChild, ViewContainerRef, ViewRef } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { FateControllerService } from '../fate-controller.service';\nimport { FateParserService } from '../fate-parser.service';\nimport { FateIconService } from '../fate-icon.service';\n\nexport const defaultButtons = [\n  'bold',\n  'italic',\n  'underline',\n  'strike',\n  'separator',\n  'subscript',\n  'superscript',\n  'link',\n  'separator',\n  'heading1',\n  'heading2',\n  'heading3',\n  'heading4',\n  'heading5',\n  'heading6',\n  'normal',\n  'separator',\n  'indent',\n  'outdent',\n  'ordered',\n  'unordered',\n  'separator',\n  'center',\n  'justify',\n  'left',\n  'right',\n  'separator',\n  'undo',\n  'redo',\n  'clean'\n];\n\n@Component({\n  selector: 'fate-ui',\n  templateUrl: './fate-ui.component.html',\n  styleUrls: ['./fate-ui.component.scss']\n})\nexport class FateUiComponent implements OnChanges, AfterViewInit {\n\n  @Input()\n  public uiId: string = 'default';\n\n  @Input()\n  public buttons: Array<string> = defaultButtons;\n\n  public enabled: any = {};\n  public dropdownAction: boolean | string = false;\n  public dropdownValue: string;\n  protected dropdownComponent: ViewRef;\n\n  protected inputSubscription: Subscription;\n\n  constructor(protected el: ElementRef, public controller: FateControllerService, public icon: FateIconService, protected parser: FateParserService, protected factoryResolver: ComponentFactoryResolver) { }\n\n  @HostListener('mousedown', ['$event'])\n  public mouseDown(event) {\n    if (!event.target.closest('.fate-ui-dropdown')) {\n      event.preventDefault();\n    }\n  }\n\n  @HostListener('keyup', ['$event'])\n  public keyUp(event) {\n    if (event.key === 'Enter') {\n      const name = event.target.name;\n      if (name) {\n        this.do(event, name);\n      }\n    }\n  }\n\n  @ViewChild('dropdown', {\n    read: ViewContainerRef,\n    static: true,\n  })\n  viewContainerRef: ViewContainerRef\n\n  public do(event, action) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (this.controller.getAction(action).dropdown) {\n      if (action === this.dropdownAction) {\n        this.dropdownAction = false;\n      } else {\n        let button = event.target;\n        if (!button.classList.contains('fate-ui-button')) {\n          button = button.closest('.fate-ui-button');\n        }\n        if(!button) {\n          return\n        }\n        const dropdown =  this.el.nativeElement.querySelector('.fate-ui-dropdown');\n\n        // Enable the dropdown\n\n        this.dropdownValue = this.enabled[action];\n        console.debug('action has value', button, dropdown, this.dropdownValue);\n        this.initDropdown(this.controller.getAction(action).dropdown, this.dropdownValue);\n\n        // Postion the dropdown\n        setTimeout(() => {\n          const buttonSize = button.getBoundingClientRect();\n          const dropdownSize =  dropdown.getBoundingClientRect();\n          let leftPosition = button.offsetLeft + (buttonSize.width / 2) - (dropdownSize.width / 2);\n          // make sure the dropdown is not bleeding out of the viewport\n          if (buttonSize.left + window.pageXOffset + (buttonSize.width / 2) - (dropdownSize.width / 2) < 3) {\n            leftPosition = - buttonSize.left - window.pageXOffset + button.offsetLeft + 3;\n          } else if (buttonSize.left + window.pageXOffset + (buttonSize.width / 2) + (dropdownSize.width / 2) > window.innerWidth - 3) {\n            leftPosition = window.innerWidth - buttonSize.left - window.pageXOffset + button.offsetLeft - dropdownSize.width - 3;\n          }\n          const topPosition = button.offsetTop + buttonSize.height - 3;\n          dropdown.style.left = leftPosition + 'px';\n          dropdown.style.top = topPosition + 'px';\n          // make the dropdown visible\n          this.dropdownAction = action;\n        }, 0);\n      }\n    } else {\n      this.dropdownAction = false;\n      this.controller.do(this.uiId, action);\n    }\n  }\n\n  protected getOffset(element) {\n    let top = 0;\n    let left = 0;\n    do {\n        top += element.offsetTop  || 0;\n        left += element.offsetLeft || 0;\n        element = element.offsetParent;\n    } while (element);\n\n    return {\n        top: top,\n        left: left\n    };\n  }\n\n  protected initDropdown(actionComponent, value) {\n    if (this.dropdownComponent) {\n      this.dropdownComponent.destroy();\n    }\n    const factory = this.factoryResolver.resolveComponentFactory(actionComponent);\n    const component: any = factory.create(this.viewContainerRef.parentInjector);\n    if (component.instance.valueChange) {\n      component.instance.value = value;\n      component.instance.valueChange.subscribe((newValue) => {\n        this.dropdownValue = newValue;\n        this.controller.do(this.uiId, this.dropdownAction, newValue);\n      });\n      this.dropdownComponent = this.viewContainerRef.insert(component.hostView);\n    } else {\n      throw new Error('The component used as a dropdown doesn\\'t contain a valueChange emmiter!');\n    }\n  }\n\n  public ngOnChanges(changes) {\n    if (changes['uiId']) {\n      if (this.inputSubscription) {\n        this.inputSubscription.unsubscribe();\n      }\n      this.inputSubscription = this.controller.enabled(this.uiId).subscribe((actions: any) => {\n        this.enabled = {};\n        for (const action of actions) {\n          this.enabled[action.action] = action.value || true;\n        }\n      });\n    }\n  }\n\n  public ngAfterViewInit() {\n    const handle = window.addEventListener('mousedown', (event) => {\n      if (!(event.target as Element).closest('.fate-ui-dropdown')) {\n        this.dropdownAction = false;\n      }\n    });\n  }\n}\n","import { Component, Input, Output, ViewChild, ElementRef, ViewRef, ViewContainerRef, ComponentFactoryResolver, OnInit, OnChanges, AfterViewInit, OnDestroy, EventEmitter } from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\nimport { Subscription } from 'rxjs';\n\nimport { FateControllerService } from '../fate-controller.service';\nimport { FateHtmlParserService } from '../fate-html-parser.service';\nimport { FateParserService } from '../fate-parser.service';\n\n@Component({\n  selector: 'fate-input',\n  template: `\n    <div class=\"fate-inline-dropdown\"\n         [class.hidden]=\"!inlineAction\"\n         [class.contextual]=\"inlineAction?.display === 'contextual'\"\n         [style.top]=\"dropdownPostionTop\"\n         [style.left]=\"dropdownPostionLeft\">\n      <ng-template #dropdown></ng-template>\n    </div>\n    <div [class]=\"'fate-edit-target ' + customClass\"\n         [ngClass]=\"{empty: empty}\"\n         contenteditable=\"true\"\n         [title]=\"placeholder\"\n         [innerHtml]=\"content\"></div>\n  `,\n  styles: [`\n    :host div.fate-edit-target {\n      display: block;\n      padding: 10px;\n      border: 1px solid #DDD;\n      outline: 0;\n      resize: vertical;\n      overflow: auto;\n      background: #FFF;\n      color: #000;\n      overflow: visible;\n    }\n    :host div.fate-edit-target.empty:not(:focus):before {\n      content:attr(title);\n      color: #636c72;\n    }\n    .fate-inline-dropdown {\n      border: 1px solid #DDD;\n      border-bottom: 0;\n    }\n    .fate-inline-dropdown.hidden {\n      display: none !important;\n    }\n    .fate-inline-dropdown.contextual {\n      position: absolute;\n      background: #FFF;\n      box-shadow: 0 5px 30px -10px rgba(0,0,0,0.4);\n      border-bottom: 1px solid #CCC;\n    }\n    :host {\n      margin-bottom: 10px;\n      /*position: relative;*/\n    }\n  `],\n  providers: [\n    {provide: NG_VALUE_ACCESSOR, useExisting: FateInputComponent, multi: true}\n  ],\n})\nexport class FateInputComponent implements ControlValueAccessor, OnChanges, OnInit, AfterViewInit, OnDestroy {\n\n  @Input()\n  public uiId: string = 'default';\n\n  @Input()\n  public row: number;\n\n  @Input()\n  public customClass: string;\n\n  @Input()\n  public placeholder: string = '';\n\n  @Output()\n  public focus = new EventEmitter<void>();\n\n  @Output()\n  public blur = new EventEmitter<void>();\n\n  @ViewChild('dropdown', {\n    read: ViewContainerRef,\n    static: true,\n  })\n  viewContainerRef: ViewContainerRef\n  protected dropdownComponent: ViewRef;\n  protected dropdownInstance: any;\n  public dropdownPostionTop: string;\n  public dropdownPostionLeft: string;\n  public inlineAction: any;\n\n  public content: SafeHtml;\n  public empty: boolean = true;\n  protected editTarget: any;\n  protected isFocused: boolean = false;\n\n  constructor(protected el: ElementRef, protected controller: FateControllerService, protected htmlParser: FateHtmlParserService, protected parser: FateParserService, protected sanitizer: DomSanitizer, protected factoryResolver: ComponentFactoryResolver) {}\n\n  private reactToChanges() {\n    const tree = this.htmlParser.parseElement(this.editTarget);\n    const serializedTree = this.parser.serialize(tree);\n    this.changed.forEach(f => f(serializedTree));\n  }\n\n  public ngOnInit() {\n    this.subscribeToUi(this.uiId);\n  }\n\n  public ngAfterViewInit() {\n    this.editTarget = this.el.nativeElement.querySelector('.fate-edit-target');\n    if (this.row) {\n      this.computeHeight();\n    }\n\n    this.editTarget.addEventListener('click', (event: any)=> {\n      console.debug('click');\n      // On click we save the text Selection\n      this.saveSelection();\n      // We check if there is a dropdown matching this context\n      this.checkForDropdownContext();\n    });\n\n    this.editTarget.addEventListener('keyup', (event: any)=> {\n      console.debug('keypressed');\n      // On click we save the text Selection\n      this.saveSelection();\n      // We check if there is a dropdown matching this context\n      this.checkForDropdownContext();\n    });\n\n    this.editTarget.addEventListener('focus', (event: any)=> {\n      console.debug('(' + this.uiId + ') focus');\n      // On focus we restore it\n      this.restoreSelection();\n      this.isFocused = true;\n      this.focus.emit();\n    });\n    this.editTarget.addEventListener('blur', (event: any)=> {\n      console.debug('(' + this.uiId + ') blur');\n      this.isFocused = false;\n      this.blur.emit();\n      this.saveSelection();\n\n      if (this.dropdownComponent) {\n        setTimeout(() => {\n          this.inlineAction = null;\n          this.dropdownComponent.destroy();\n        }, 300);\n        // this.inlineAction = null;\n        // this.dropdownComponent.destroy();\n      }\n    });\n\n    this.editTarget.addEventListener('keydown', (event: any)=> {\n      console.debug('keydown', event);\n      const stopDefault = () => {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n      const stopDefaultAndForceUpdate = () => {\n        stopDefault();\n        this.checkEmpty();\n        this.reactToChanges();\n      }\n      // This is needed because, if the current selection is part\n      // of a non-editable child of the input, the default delete won't\n      // work.\n      // This case can happen if there is a cutom element that\n      // was inserted by some custom controller.\n      //\n      // Some constraints for a custom block to work on top of contenteditable=false:\n      // -moz-user-select: none;\n      // -webkit-user-modify: read-only;\n      //\n      // Note: It may make sense to delete the selection for normal text\n      // input too but for now we only do it on deletion.\n      if (event.key === 'Backspace' || event.key === 'Delete' && this.selectionRange) {\n        const node = this.selectionRange.commonAncestorContainer;\n        console.debug('Deletion', node);\n        if (node instanceof HTMLElement && !(node as HTMLElement).isContentEditable) {\n          // this is the case on firefox\n          console.debug('deleting inside un-editable block detected');\n          this.selectionRange.selectNode(node);\n          this.selectionRange.deleteContents();\n          stopDefaultAndForceUpdate();\n        } else if (node.nodeName === '#text' && !node.parentElement.isContentEditable) {\n          // this is the case on webkit\n          console.debug('deleting inside un-editable block detected');\n          this.selectionRange.selectNode(node.parentElement);\n          this.selectionRange.deleteContents();\n          stopDefaultAndForceUpdate();\n        }\n      }\n      // This is needed because, there is a bug in Firefox that prevent\n      // deleting a uneditable element inside an editable element. So we\n      // reimplement the whole function for all browsers.\n      if (event.key === 'Backspace' && this.selectionRange) {\n        const node = this.selectionRange.commonAncestorContainer;\n        if (this.selectionRange.collapsed === true &&\n            this.selectionRange.startOffset === 0 &&\n            node.previousSibling instanceof HTMLElement &&\n            !(node.previousSibling as HTMLElement).isContentEditable ) {\n          node.previousSibling.remove();\n          stopDefaultAndForceUpdate();\n        }\n      } else if (event.key === 'Delete' && this.selectionRange) {\n        const node = this.selectionRange.commonAncestorContainer;\n        if (this.selectionRange.collapsed === true &&\n            this.selectionRange.endContainer.nodeName === '#text' &&\n            this.selectionRange.endOffset === (this.selectionRange.endContainer as Text).length &&\n            node.nextSibling instanceof HTMLElement &&\n            !(node.nextSibling as HTMLElement).isContentEditable ) {\n          node.nextSibling.remove();\n          stopDefaultAndForceUpdate();\n        }\n      }\n      // If a dropdown is currently being displayed we use the up/down\n      // key to navigate its content and return to select the selected\n      // element\n      if (this.inlineAction) {\n        if (event.key === 'Up' || event.key === 'ArrowUp') {\n          stopDefault();\n          this.dropdownInstance.selecPrevious();\n        } else if (event.key === 'Down' || event.key === 'ArrowDown') {\n          stopDefault();\n          this.dropdownInstance.selectNext();\n        } else if (event.key === 'Enter') {\n          stopDefault();\n          this.dropdownInstance.confirmSelection();\n        }\n      }\n    });\n\n    this.editTarget.addEventListener('input', (event: any)=> {\n      console.debug('value changed');\n      this.checkEmpty();\n      this.reactToChanges();\n    });\n    const style: any = window.getComputedStyle(this.editTarget);\n    this.editTarget.style.minHeight = this.getHeight(2);\n  }\n\n  public ngOnChanges(changes) {\n    if (changes['uiId']) {\n      this.subscribeToUi(this.uiId);\n    }\n    if (changes['row']) {\n      if (this.editTarget) {\n        this.computeHeight();\n      }\n    }\n  }\n\n  public ngOnDestroy() {\n    if (this.uiSubscription) {\n      this.uiSubscription.unsubscribe();\n    }\n  }\n\n  protected computeHeight() {\n    this.editTarget.style.height = this.getHeight(this.row);\n  }\n\n  protected checkEmpty() {\n    if (this.editTarget.innerHTML === '') {\n      this.editTarget.innerHTML = '<br>';\n      this.empty = true;\n    } else if (this.editTarget.innerHTML === '<br>') {\n      this.empty = true;\n    } else {\n      this.empty = false;\n    }\n  }\n\n  protected getHeight(rowCount) {\n    const style: any = window.getComputedStyle(this.editTarget);\n    let height = this.editTarget.style.height = (parseInt(style.lineHeight, 10) * rowCount);\n    if (style.boxSizing === 'border-box') {\n      height += parseInt(style.paddingTop, 10) + parseInt(style.paddingBottom, 10) + parseInt(style.borderTopWidth, 10) + parseInt(style.borderBottomWidth, 10);\n    }\n    return height + 'px';\n  }\n\n  protected uiSubscription: Subscription;\n  protected subscribeToUi(uiId) {\n    console.debug('subscribing to ' + uiId, this.uiSubscription);\n    if (this.uiSubscription) {\n      this.uiSubscription.unsubscribe();\n    }\n    this.uiSubscription = this.controller.channel(uiId).subscribe((command) => {\n      // if input is not on focus we save current focus:\n      const focus = document.activeElement;\n      console.debug('(' + uiId + ') got command ' + command.name + '/' + command.value);\n\n      this.restoreSelection();\n      if (command.name === 'insertHTML' && this.selectionRange) {\n        // If something is selected we assume that the goal is to replace it,\n        // so first we delete the content\n        this.selectionRange.deleteContents();\n        // insertHtml seems quite broken so we do it ourseleves\n        this.selectionRange.insertNode(document.createRange().createContextualFragment(command.value));\n        // move cusor to the end of the newly inserted element\n        this.selectionRange.collapse(false);\n        // Force the update of the model\n        this.checkEmpty();\n        this.reactToChanges();\n      } else {\n        document.execCommand(command.name, false, command.value);\n      }\n      this.saveSelection();\n      (focus as any).focus();\n    });\n  }\n\n  // Saves the current text selection\n  protected selectionRange: Range;\n  protected saveSelection() {\n    if (this.selectionInEditableTarget()) {\n      const sel = window.getSelection();\n      if (sel.getRangeAt && sel.rangeCount) {\n        this.selectionRange = sel.getRangeAt(0);\n        console.debug('(' + this.uiId + ') saveSelection', this.selectionRange);\n        this.detectStyle();\n      }\n    }\n  }\n  // Restors the current text selection\n  protected restoreSelection() {\n    if (this.selectionInEditableTarget()) {\n      return;\n    }\n    console.debug('(' + this.uiId + ') restoreSelection', this.selectionRange);\n    if (this.selectionRange) {\n      const sel = window.getSelection();\n      sel.removeAllRanges();\n      sel.addRange(this.selectionRange);\n    }\n  }\n\n  protected selectionInEditableTarget() {\n    const sel = window.getSelection();\n    const node = sel.getRangeAt && sel.rangeCount && sel.getRangeAt(0) && sel.getRangeAt(0).commonAncestorContainer;\n    return node && (node === this.editTarget || (node.parentElement.closest('.fate-edit-target') && (node.parentElement.closest('.fate-edit-target') === this.editTarget)));\n  }\n\n  protected detectStyle() {\n    let node = this.selectionRange.commonAncestorContainer;\n    if (!node || (!(node.parentElement.closest('.fate-edit-target') && node !== this.editTarget))){\n      // The current selection is not contained in the editable zone.\n      // this is most likely due to the input being empty.\n      return;\n    }\n    // special cases for FF when selection is obtained by double click:\n    if ((this.selectionRange.endOffset === 0) &&\n        (this.selectionRange.startContainer.nodeValue) &&\n        (this.selectionRange.startOffset === this.selectionRange.startContainer.nodeValue.length)) {\n      node = this.selectionRange.startContainer.nextSibling;\n    } else if ((this.selectionRange.endOffset === 0) &&\n        (this.selectionRange.startOffset === 0)) {\n      node = this.selectionRange.startContainer.parentElement;\n    } else if ((this.selectionRange.commonAncestorContainer === this.editTarget) &&\n               (this.selectionRange.startContainer === this.editTarget) &&\n               (this.selectionRange.endContainer === this.editTarget)) {\n      node = this.selectionRange.commonAncestorContainer.childNodes[this.selectionRange.startOffset];\n    }\n    if (node && node !== this.editTarget) {\n      const nodes = this.htmlParser.findParentNodes(node, this.editTarget);\n      console.debug('  -> detected actions: ', nodes);\n      this.controller.enableActions(this.uiId, nodes);\n    }\n  }\n\n  // implentation of ControlValueAccessor:\n  protected changed = new Array<(value: string) => void>();\n\n  public writeValue(value: string) {\n    if (value) {\n      this.content = this.sanitizer.bypassSecurityTrustHtml(this.htmlParser.serialize(this.parser.parse(value)));\n      this.empty = false;\n    } else {\n      this.content = this.sanitizer.bypassSecurityTrustHtml('<br>');\n      this.empty = true;\n    }\n    this.selectionRange = undefined;\n  }\n\n  public registerOnChange(fn: (value: string) => void) {\n    this.changed.push(fn);\n  }\n\n  public registerOnTouched(fn: () => void) {}\n\n  protected checkForDropdownContext() {\n    const startPos = Math.max(this.selectionRange.startOffset - 20, 0);\n    const length = this.selectionRange.startOffset - startPos;\n    const context = this.selectionRange.startContainer.textContent.substr(startPos, length);\n\n    const inlineAction = this.controller.getInlineAction(context);\n    if (inlineAction) {\n      if (!this.inlineAction || this.inlineAction.dropdown !== inlineAction.dropdown) {\n        this.inlineAction = inlineAction;\n        this.initDropdown(inlineAction, this.selectionRange.getBoundingClientRect());\n      } else {\n        this.inlineAction = inlineAction;\n        this.updateDropdown(inlineAction.matched);\n      }\n    } else if (this.dropdownComponent) {\n      this.inlineAction = null;\n      this.dropdownComponent.destroy();\n    }\n  }\n\n  protected initDropdown(actionComponent, position) {\n    // set the dropdown component\n    if (this.dropdownComponent) {\n      this.dropdownComponent.destroy();\n    }\n    const factory = this.factoryResolver.resolveComponentFactory(actionComponent.dropdown);\n    const component: any = factory.create(this.viewContainerRef.parentInjector);\n    if (component.instance.valueChange) {\n      component.instance.value = actionComponent.matched;\n      component.instance.valueChange.subscribe((value) => {\n        this.editTarget.focus();\n        const end = this.selectionRange.endOffset;\n        this.selectionRange.setStart(this.selectionRange.endContainer, end - actionComponent.matched.length);\n        this.controller.doInline(this.uiId, this.inlineAction, value);\n        // delete the dropdown\n        this.inlineAction = null;\n        this.dropdownComponent.destroy();\n      });\n      this.dropdownComponent = this.viewContainerRef.insert(component.hostView);\n      this.dropdownInstance = component.instance;\n      this.updateDropdownPosition();\n    } else {\n      throw new Error('The component used as a dropdown doesn\\'t contain a valueChange emmiter!');\n    }\n  }\n\n  protected updateDropdown(value) {\n    this.dropdownInstance.value = value;\n    this.updateDropdownPosition();\n  }\n\n  protected updateDropdownPosition() {\n    if (this.inlineAction.display === 'contextual') {\n      // create a selection to get the size of the matching text\n      const parentOffsetBB = this.el.nativeElement.offsetParent.getBoundingClientRect();\n      const range = this.selectionRange.cloneRange();\n      const end = range.endOffset;\n      range.setStart(range.endContainer, end - this.inlineAction.matched.length);\n      const boundingBox = range.getBoundingClientRect();\n      this.dropdownPostionTop = (boundingBox.top + boundingBox.height - parentOffsetBB.top) + 'px';\n      this.dropdownPostionLeft = (boundingBox.left - parentOffsetBB.left) + 'px';\n    }\n  }\n}\n","import { Component, Input, ElementRef, HostListener, ComponentFactoryResolver } from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\n\nimport { defaultButtons } from '../fate-ui/fate-ui.component';\nimport { FateControllerService } from '../fate-controller.service';\nimport { FateParserService } from '../fate-parser.service';\nimport { FateIconService } from '../fate-icon.service';\n\nlet instanceCounter = 0;\n\n@Component({\n  selector: 'fate-bootstrap',\n  templateUrl: './fate-bootstrap.component.html',\n  styleUrls: ['./fate-bootstrap.component.scss'],\n  providers: [\n    {provide: NG_VALUE_ACCESSOR, useExisting: FateBootstrapComponent, multi: true}\n  ],\n})\nexport class FateBootstrapComponent implements ControlValueAccessor {\n\n  @Input()\n  row: number;\n\n  @Input()\n  placeholder: string;\n\n  @Input()\n  public buttons: Array<string> = defaultButtons;\n\n  // implentation of ControlValueAccessor:\n  protected changed = new Array<(value: string) => void>();\n  protected clickOngoing: boolean = false;\n\n  public passthrough: string;\n  public uiId;\n  public uiVisible;\n\n\n  @HostListener('focusout', ['$event'])\n  public blur (event: any){\n    if (!this.clickOngoing){\n      this.uiVisible = false;\n    }\n  }\n\n  @HostListener('mousedown', ['$event'])\n  public mousedown (event: any){\n    this.clickOngoing = true;\n  }\n\n  @HostListener('mouseup', ['$event'])\n  public mouseup (event: any){\n    this.clickOngoing = false;\n  }\n\n  @HostListener('focusin', ['$event'])\n  public focus (event: any){\n    this.uiVisible = true;\n    console.info('boostrap focus!')\n  }\n\n  constructor(el: ElementRef, controller: FateControllerService, parser: FateParserService, icon: FateIconService, factoryResolver: ComponentFactoryResolver) {\n    this.uiId = 'bootstrap-' + (instanceCounter++);\n  }\n\n  public writeValue(value: string) {\n    this.passthrough = value;\n  }\n\n  public registerOnChange(fn: (value: string) => void) {\n    this.changed.push(fn);\n  }\n\n  public registerOnTouched(fn: () => void) {}\n\n  // change callback\n  public onChange(value) {\n    this.passthrough = value;\n    this.changed.forEach(f => f(value));\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { FateIconService } from './fate-icon.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FateMaterialIconService extends FateIconService {}\n","import { Component, Input, HostBinding, HostListener, Optional, Self, ElementRef, OnDestroy } from '@angular/core';\nimport { ControlValueAccessor, NgControl } from '@angular/forms';\nimport { MatFormFieldControl } from '@angular/material/form-field';\nimport { coerceBooleanProperty } from '@angular/cdk/coercion';\n\nimport { defaultButtons } from '../fate-ui/fate-ui.component';\nimport { FateControllerService } from '../fate-controller.service';\nimport { FateParserService } from '../fate-parser.service';\nimport { FateIconService } from '../fate-icon.service';\nimport { FateMaterialIconService } from '../fate-material-icon.service';\n\nimport { Subject } from 'rxjs';\n\nlet instanceCounter = 0;\n\n@Component({\n  selector: 'fate-material',\n  templateUrl: './fate-material.component.html',\n  styleUrls: ['./fate-material.component.scss'],\n  providers: [\n    { provide: MatFormFieldControl, useExisting: FateMaterialComponent },\n    { provide: FateIconService, useClass: FateMaterialIconService }\n  ],\n})\nexport class FateMaterialComponent implements  ControlValueAccessor, OnDestroy, MatFormFieldControl<string>  {\n\n  @Input()\n  row: number;\n\n  @Input()\n  public buttons: Array<string> = defaultButtons;\n\n  @Input()\n  public get value(): string {\n    return this.passthrough;\n  }\n  public set value(value: string) {\n    this.stateChanges.next();\n    this.passthrough = value;\n    this.changed.forEach(f => f(value));\n  }\n  public passthrough: string;\n\n  @Input()\n  get placeholder() {\n    return this._placeholder;\n  }\n  set placeholder(placeholder) {\n    this._placeholder = placeholder;\n    this.stateChanges.next();\n  }\n  protected _placeholder: string;\n\n  public uiId;\n  @HostBinding()\n  id = `${this.uiId}`;\n\n  @HostListener('focusout')\n  public blur() {\n    this.focused = false;\n    this.stateChanges.next();\n    if (!this.clickOngoing){\n      this.uiVisible = false;\n    }\n  }\n\n  @HostListener('focusin')\n  public focus() {\n    this.focused = true;\n    this.uiVisible = true;\n    this.stateChanges.next();\n  }\n\n  @HostListener('mousedown', ['$event'])\n  public mousedown (event: any){\n    this.clickOngoing = true;\n  }\n\n  @HostListener('mouseup', ['$event'])\n  public mouseup (event: any){\n    this.clickOngoing = false;\n  }\n  public clickOngoing = false;\n  public uiVisible = false;\n\n  get empty() {\n    return !this.passthrough || this.passthrough === '';\n  }\n\n  get shouldLabelFloat() {\n    return this.focused || !this.empty;\n  }\n\n  @Input()\n  get required() {\n    return this._required;\n  }\n  set required(req) {\n    this._required = coerceBooleanProperty(req);\n    this.stateChanges.next();\n  }\n  protected _required = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(dis) {\n    this._disabled = coerceBooleanProperty(dis);\n    this.stateChanges.next();\n  }\n  protected _disabled = false;\n\n  public errorState = false;\n\n  public controlType = 'fate-material';\n\n  @HostBinding('attr.aria-describedby')\n  describedBy = '';\n\n  public setDescribedByIds(ids: string[]) {\n    this.describedBy = ids.join(' ');\n  }\n\n  public onContainerClick(event: MouseEvent) {}\n\n  public stateChanges = new Subject<void>();\n  public focused = false;\n\n  protected changed = new Array<(value: string) => void>();\n\n  constructor(controller: FateControllerService, parser: FateParserService, icon: FateIconService, el: ElementRef, @Optional() @Self() public ngControl: NgControl) {\n    this.uiId = 'material-' + (instanceCounter++);\n    // Setting the value accessor directly (instead of using\n    // the providers) to avoid running into a circular import.\n    if (this.ngControl != null) {\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  public onChange(value) {\n    this.passthrough = value;\n    this.changed.forEach(f => f(value));\n    this.stateChanges.next();\n  }\n\n  public ngOnDestroy() {\n    this.stateChanges.complete();\n  }\n\n  public writeValue(value: string) {\n    this.passthrough = value;\n    this.stateChanges.next();\n  }\n\n  public registerOnChange(fn: (value: string) => void) {\n    this.changed.push(fn);\n  }\n\n  public registerOnTouched(fn: () => void) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport { FateIconService } from './fate-icon.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FateFontawsomeLegacyIconService extends FateIconService {\n\n  protected iconMapping = {\n    'bold' : '<i class=\"fa fa-bold\"></i>',\n    'italic' : '<i class=\"fa fa-italic\"></i>',\n    'underline' : '<i class=\"fa fa-underline\"></i>',\n    'strike' : '<i class=\"fa fa-strikethrough\"></i>',\n    'subscript' :  '<i class=\"fa fa-subscript\"></i>',\n    'superscript' : '<i class=\"fa fa-superscript\"></i>',\n    'indent' : '<i class=\"fa fa-indent\"></i>',\n    'outdent' : '<i class=\"fa fa-outdent\"></i>',\n    'ordered' : '<i class=\"fa fa-list-ol\"></i>',\n    'unordered' : '<i class=\"fa fa-list-ul\"></i>',\n    'center' : '<i class=\"fa fa-align-center\"></i>',\n    'justify' : '<i class=\"fa fa-align-justify\"></i>',\n    'left' : '<i class=\"fa fa-align-left\"></i>',\n    'right' : '<i class=\"fa fa-align-right\"></i>',\n    'undo' : '<i class=\"fa fa-undo\"></i>',\n    'redo' : '<i class=\"fa fa-repeat\"></i>',\n    'clean' : '<i class=\"fa fa-eraser\"></i>',\n    'link' : '<i class=\"fa fa-link\"></i>',\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { FontAwesomeModule } from '@fortawesome/angular-fontawesome';\n\nimport { FateUiComponent } from './fate-ui/fate-ui.component';\nimport { FateInputComponent } from './fate-input/fate-input.component';\nimport { FateBootstrapComponent } from './fate-bootstrap/fate-bootstrap.component';\nimport { FateMaterialComponent } from './fate-material/fate-material.component';\nimport { FateLinkDropdownComponent } from './fate-link-dropdown/fate-link-dropdown.component';\n\nexport { FateParser } from './fate-parser.interface';\nexport { FateIcon } from './fate-icon.interface';\nexport { FateDropdown } from './fate-dropdown.interface';\nexport { FateUiComponent } from './fate-ui/fate-ui.component';\nexport { FateInputComponent } from './fate-input/fate-input.component';\nexport { FateLinkDropdownComponent } from './fate-link-dropdown/fate-link-dropdown.component';\nexport { FateIconService } from './fate-icon.service';\nexport { FateMaterialIconService } from './fate-material-icon.service';\nexport { FateFontawsomeLegacyIconService } from './fate-fontawsome-legacy-icon.service';\nexport { FateParserService } from './fate-parser.service';\nexport { FateControllerService, FateCommand } from './fate-controller.service';\nexport { FateHtmlParserService } from './fate-html-parser.service';\nexport { FateNode } from './fate-node';\nexport { FateType } from './fate-type.enum';\n\n@NgModule({\n  declarations: [\n    FateInputComponent,\n    FateUiComponent,\n    FateBootstrapComponent,\n    FateLinkDropdownComponent\n  ],\n  imports: [CommonModule, FormsModule, MatFormFieldModule, FontAwesomeModule],\n  exports: [\n    FateUiComponent,\n    FateInputComponent,\n    FateBootstrapComponent,\n    FateLinkDropdownComponent\n  ]\n})\nexport class FateModule {}\n\n@NgModule({\n  declarations: [FateMaterialComponent],\n  imports: [CommonModule, FormsModule, MatFormFieldModule, FateModule],\n  exports: [FateMaterialComponent]\n})\nexport class FateMaterialModule {}\n"]}